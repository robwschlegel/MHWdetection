<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assessing the effects of time series duration • MHWdetection</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Assessing the effects of time series duration">
<meta property="og:description" content="This vignette investigates the effects of time series duration on the accurate detection of MHWs.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MHWdetection</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/r_vs_python.html">Python vs. R - default outputs</a>
    </li>
    <li>
      <a href="../articles/r_vs_python_arguments.html">Python vs. R - default arguments</a>
    </li>
    <li>
      <a href="../articles/r_vs_python_additional.html">Python vs. R - additional functions</a>
    </li>
    <li>
      <a href="../articles/Short_climatologies.html">Short climatologies</a>
    </li>
    <li>
      <a href="../articles/Climatologies_and_baselines.html">Alternative climatologies and baselines</a>
    </li>
    <li>
      <a href="../articles/time_series_duration.html">Effects of short time series</a>
    </li>
    <li>
      <a href="../articles/missing_data.html">Effects of missing data</a>
    </li>
    <li>
      <a href="../articles/gridded_products.html">Difference between gridded products</a>
    </li>
    <li>
      <a href="../articles/best_practices.html">Best practices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/MHWdetection">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Assessing the effects of time series duration</h1>
                        <h4 class="author">Robert W Schlegel</h4>
            
            <h4 class="date">2019-03-06</h4>
      
      
      <div class="hidden name"><code>time_series_duration.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>It has been shown that the length (duration) of a time series may be one of the most important factors in determining the usefulness of those data for any number of applications <span class="citation">(Schlegel and Smit 2016)</span>. For the detection of MHWs it is recommended that one has at least 30 years of data in order to accurately detect the events therein. This is no longer an issue for most ocean surfaces because many high quality SST products, such as NOAA OISST, are now in exceedence of the 30-year minimum. However, besides issues relating to the coarseness of these older products, there are many other reasons why one would want to detect MHWs in products with shorter records. <em>In situ</em> measurements along the coast are one good example of this, another being the use of the newer higher resolution SST products, a third being the use of reanalysis/model products for the detection of events in 3D. It is therefore necessary to quantify the effects that shorter time series duration (&lt; 30 years) has on the accurate detection of events. Once any discrepancies have been accounted for, best practices must be developed to allow users to improve the precision of the detection of events in their shorter time series.</p>
</div>
<div id="time-series-shortening" class="section level2">
<h2 class="hasAnchor">
<a href="#time-series-shortening" class="anchor"></a>Time series shortening</h2>
<p>A time series derives it’s usefulness from it’s length. This is generally because the greater the number of observations (larger sample size), the more confident one can be about the resultant statistics. This is particularly true for decadal scale measurements and is why the WMO recommends a minimum of 30 years of data before drawing any conclusions about decadal (long-term) trends observed in a time series. We however want to look not at decadal scale trends, but rather at how observed MHWs compare against one another when they have been detected using longer or shorter time series. In order to to quantify this effect we will use the minimum and maximum range of time series available to us. The maximum length will be 37 years, as this is the full extent of the NOAA OISST data included in <strong><code>heatwaveR</code></strong>. The minimum length for comparing the seasonal signal and 90th percentile thresholds will be three years as his is the minimum number of years required to calculate a climatology. For comparing MHWs the minimum will be ten years so that we may still have enough events detected between shortened time series to produce robust statistics.</p>
<p>Before we can discuss shortening techniques, we must first consider the inherent decadal trend in the time series themselves. This is usually the primary driver for much of the event detection changes over time <span class="citation">(Oliver et al. 2018)</span>. Therefore, if we truly want to understand the effect that a shortened time series may have on event detection, apart from the effect of the decadal trend, we must de-trend the time series first. To this end there is an entire separate <a href="https://robwschlegel.github.io/MHWdetection/articles/trend.html">vignette</a> that quantifies the effect of long-term trends on the detection of events.</p>
<p>The time series shortening technique proposed here is <a href="https://robwschlegel.github.io/MHWdetection/articles/Short_climatologies.html">re-sampling</a>. This methodology takes the full 37 year de-trended time series and randomly samples <em>n</em> years from it to simulate a 3 – 37 year time series. One then uses the jumbled up, randomly selected years of data to create the seasonal signal and 90th percentile threshold (hereafter referred to as “the climatologies”). Re-sampling the time series in this way is useful because it allows us to replicate random climatology creation 100 (or more) times for each time series length in order to produce a more confident estimation of how likely climatologies generated from certain time series lengths are to impact the accuracy of event detection. It also allows us to see how consistent the size of MHWs are in a given time series, or if they very quite a bit depending on the years used.</p>
<p>The WMO recommends that the period used to create a climatology be 30 years in length, starting on the first year of a decade (e.g. 1981), however; because we are going to be running these analyses on many time series shorter than 30 years, for the sake of consistency we will use all of the years present in each re-sampled time series them as the climatology period, regardless of length. For example, if a time series spans 1982 – 2018, that will be the period used for calculating the climatologies. Likewise, should the time series only span the years 2006 – 2018, that will be the period used.</p>
<p>The effect this has on the climatologies will be quantified through the following statistics:</p>
<ul>
<li>An ANOVA will compare the climatologies created from different lengths;</li>
<li>A post-hoc Tukey test to determine where the difference in time series length for climatology creation become significant;</li>
<li>Correlations between time series length/SD and seas/thresh mean/SD</li>
<li>Kolmogorov-Smirnov test for where the climatologies diverge significantly from the 30 year climatologies</li>
</ul>
<p>The effect this has on the MHW metrics will be quantified with the following statistics:</p>
<ul>
<li>ANOVA comparing the primary metrics for MHWs detected using different time series lengths;</li>
<li>A post-hoc Tukey test to show where the difference in time series length for event detection become significant;</li>
<li>Confidence intervals (CIs) for the measured metrics</li>
<li>Correlations between time series length/SD and MHW metrics</li>
</ul>
<p>In addition to checking all of the statistics mentioned above, it is also necessary to record what the overall relationship is with the reduction of time series length and the resultant climatologies/metrics. For example, are MHWs on average more intense in shorter time series or less? We must also look into how the categories of the events are affected. This will form part of the best practice advice later.</p>
</div>
<div id="re-sampling" class="section level2">
<h2 class="hasAnchor">
<a href="#re-sampling" class="anchor"></a>Re-sampling</h2>
<p>Below we use <a href="https://robwschlegel.github.io/MHWdetection/articles/Short_climatologies.html">re-sampling</a> to simulate 100 time series at each length of 3 – 37 years on de-trended data. This is presently being done with the three pre-packaged time series available in the <strong><code>heatwaveR</code></strong> package and the python distribution, but eventually will be run on the global data. The original data are appended to these 100 re-samples as <code>rep = 0</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(heatwaveR, <span class="dt">lib.loc =</span> <span class="st">"../../R-packages/"</span>)
<span class="co"># cat(paste0("heatwaveR version = ",packageDescription("heatwaveR")$Version))</span>
<span class="kw">library</span>(lubridate) <span class="co"># This is intentionally activated after data.table</span>
<span class="kw">library</span>(fasttime)
<span class="kw">library</span>(ggpubr)
<span class="kw">library</span>(boot)
<span class="kw">library</span>(FNN)
<span class="kw">library</span>(mgcv)
<span class="kw">library</span>(doMC); doMC<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/doMC/topics/registerDoMC">registerDoMC</a></span>(<span class="dt">cores =</span> <span class="dv">50</span>)

MHW_colours &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">"I Moderate"</span> =<span class="st"> "#ffc866"</span>,
  <span class="st">"II Strong"</span> =<span class="st"> "#ff6900"</span>,
  <span class="st">"III Severe"</span> =<span class="st"> "#9e0000"</span>,
  <span class="st">"IV Extreme"</span> =<span class="st"> "#2d0000"</span>
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First put all of the data together and create a site column</span>
sst_ALL &lt;-<span class="st"> </span><span class="kw">rbind</span>(sst_Med, sst_NW_Atl, sst_WA) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">site =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">"Med"</span>, <span class="st">"NW_Atl"</span>, <span class="st">"WA"</span>), <span class="dt">each =</span> <span class="dv">13514</span>))
<span class="kw">save</span>(sst_ALL, <span class="dt">file =</span> <span class="st">"data/sst_ALL.Rdata"</span>)

<span class="co"># Function to remove the trend from a time series</span>
detrend &lt;-<span class="st"> </span><span class="cf">function</span>(df){
  resids &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/augment">augment</a></span>(<span class="kw">lm</span>(temp <span class="op">~</span><span class="st"> </span>t, df))
  res &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">temp =</span> temp <span class="op">-</span><span class="st"> </span>resids<span class="op">$</span>.fitted)
  <span class="kw">return</span>(res)
}

<span class="co"># Then create a de-trended version</span>
sst_ALL_detrend &lt;-<span class="st"> </span>sst_ALL <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">detrend</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as.tibble</span>(.) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(site, t, temp)

<span class="kw">save</span>(sst_ALL_detrend, <span class="dt">file =</span> <span class="st">"data/sst_ALL_detrend.Rdata"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Function for creating a re-sample from 37 years of data</span>
sample_<span class="dv">37</span> &lt;-<span class="st"> </span><span class="cf">function</span>(rep){
  year_filter &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)
  <span class="cf">while</span>(<span class="kw">length</span>(<span class="kw">unique</span>(year_filter)) <span class="op">!=</span><span class="st"> </span><span class="dv">37</span>){
    year_filter &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">sample</span>(<span class="dv">1982</span><span class="op">:</span><span class="dv">2018</span>, <span class="dt">size =</span> <span class="dv">37</span>, <span class="dt">replace =</span> F))
  }
  res &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(year_filter)){
    df_sub &lt;-<span class="st"> </span>sst_ALL_detrend <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">filter</span>(<span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(t) <span class="op">==</span><span class="st"> </span>year_filter[i],
             <span class="co"># Remove leap-days here</span>
             <span class="kw">paste0</span>(<span class="kw"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span>(t),<span class="st">"-"</span>,<span class="kw"><a href="http://lubridate.tidyverse.org/reference/day.html">day</a></span>(t)) <span class="op">!=</span><span class="st"> "2-29"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year =</span> <span class="kw">seq</span>(<span class="dv">1982</span>,<span class="dv">2018</span>)[i],
             <span class="dt">month =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span>(t),
             <span class="dt">day =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/day.html">day</a></span>(t),
             <span class="dt">year_orig =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(t)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">t =</span> <span class="kw">as.Date</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/fasttime/topics/fastPOSIXct">fastPOSIXct</a></span>(<span class="kw">paste</span>(year, month, day, <span class="dt">sep =</span> <span class="st">"-"</span>)))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">select</span>(<span class="op">-</span>year, <span class="op">-</span>month, <span class="op">-</span>day)
    res &lt;-<span class="st"> </span><span class="kw">rbind</span>(res, df_sub)
  }
  res<span class="op">$</span>rep &lt;-<span class="st"> </span><span class="kw">as.character</span>(rep)
  <span class="kw">return</span>(res)
}

<span class="co"># Re-sample the data 100 times</span>
doMC<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/doMC/topics/registerDoMC">registerDoMC</a></span>(<span class="dt">cores =</span> <span class="dv">25</span>)
sst_ALL_repl &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ldply">ldply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, sample_<span class="dv">37</span>, <span class="dt">.parallel =</span> T)

<span class="co"># Add the original data as rep = "0"</span>
sst_ALL_<span class="dv">0</span> &lt;-<span class="st"> </span>sst_ALL_detrend <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_orig =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(t),
         <span class="dt">rep =</span> <span class="st">"0"</span>)

sst_ALL_repl &lt;-<span class="st"> </span><span class="kw">rbind</span>(sst_ALL_<span class="dv">0</span>, sst_ALL_repl)

<span class="kw">save</span>(sst_ALL_repl, <span class="dt">file =</span> <span class="st">"data/sst_ALL_repl.Rdata"</span>)
<span class="kw">rm</span>(sst_ALL_<span class="dv">0</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_repl.Rdata"</span>)

<span class="co"># Calculate climatologies, events, and categories on shrinking time series</span>
shrinking_results &lt;-<span class="st"> </span><span class="cf">function</span>(year_begin){
  sst_ALL_res &lt;-<span class="st"> </span>sst_ALL_repl <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>year_orig) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(<span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(t) <span class="op">&gt;=</span><span class="st"> </span>year_begin) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> <span class="dv">2018</span><span class="op">-</span>year_begin<span class="op">+</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(rep, site, year_index) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">clims =</span> <span class="kw">map</span>(data, ts2clm, 
                       <span class="dt">climatologyPeriod =</span> <span class="kw">c</span>(<span class="kw">paste0</span>(year_begin,<span class="st">"-01-01"</span>), <span class="st">"2018-12-31"</span>)),
           <span class="dt">events =</span> <span class="kw">map</span>(clims, detect_event),
           <span class="dt">cats =</span> <span class="kw">map</span>(events, category)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>data, <span class="op">-</span>clims)
  <span class="kw">return</span>(sst_ALL_res)
}

<span class="co"># Run this preferably with at least 35 cores for speed, RAM allowing</span>
doMC<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/doMC/topics/registerDoMC">registerDoMC</a></span>(<span class="dt">cores =</span> <span class="dv">50</span>)
sst_ALL_smooth &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ldply">ldply</a></span>(<span class="dv">1982</span><span class="op">:</span><span class="dv">2016</span>, shrinking_results, <span class="dt">.parallel =</span> T)

<span class="kw">save</span>(sst_ALL_smooth, <span class="dt">file =</span> <span class="st">"data/sst_ALL_smooth.Rdata"</span>)
<span class="kw">rm</span>(sst_ALL_repl)</code></pre></div>
</div>
<div id="climatology-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#climatology-statistics" class="anchor"></a>Climatology statistics</h2>
<p>We will now see if the 100 re-sampled time series produce significantly different climatologies as they are shortened. If so, we also want to see at what point the climatologies begin to diverge.</p>
<div id="anova-p-values" class="section level3">
<h3 class="hasAnchor">
<a href="#anova-p-values" class="anchor"></a>ANOVA <em>p</em>-values</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Run an ANOVA on each metric of the combined event results and get the p-value</span>
<span class="co"># df &lt;- res</span>
aov_p &lt;-<span class="st"> </span><span class="cf">function</span>(df){
  aov_models &lt;-<span class="st"> </span>df[ , <span class="op">-</span><span class="kw">grep</span>(<span class="st">"year_index"</span>, <span class="kw">names</span>(df))] <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">aov</span>(.x <span class="op">~</span><span class="st"> </span>df<span class="op">$</span>year_index)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(.), <span class="dt">.id =</span> <span class="st">'metric'</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">p.value =</span> <span class="kw">round</span>(p.value, <span class="dv">4</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> "Residuals"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(metric, p.value)
  <span class="kw">return</span>(aov_models)
  }

<span class="co"># Run an ANOVA on each metric and then a Tukey test</span>
aov_tukey &lt;-<span class="st"> </span><span class="cf">function</span>(df){
  aov_tukey &lt;-<span class="st"> </span>df[ , <span class="op">-</span><span class="kw">grep</span>(<span class="st">"year_index"</span>, <span class="kw">names</span>(df))] <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw">TukeyHSD</span>(<span class="kw">aov</span>(.x <span class="op">~</span><span class="st"> </span>df<span class="op">$</span>year_index))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(.), <span class="dt">.id =</span> <span class="st">'metric'</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">p.value =</span> <span class="kw">round</span>(adj.p.value, <span class="dv">4</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="co"># filter(term != "Residuals") %&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(metric, comparison, adj.p.value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="co"># filter(adj.p.value &lt;= 0.05) %&gt;% </span>
<span class="st">    </span><span class="kw">arrange</span>(metric, adj.p.value)
  <span class="kw">return</span>(aov_tukey)
}

<span class="co"># Quick wrapper for getting results for ANOVA and Tukey on clims</span>
<span class="co"># df &lt;- sst_ALL_smooth %&gt;%</span>
<span class="co">#   filter(rep == "1", site == "WA") %&gt;%</span>
<span class="co">#   select(-rep, -site)</span>
clim_aov_tukey &lt;-<span class="st"> </span><span class="cf">function</span>(df){
  res &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(year_index, seas, thresh) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> <span class="kw">as.factor</span>(year_index)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">aov =</span> <span class="kw">map</span>(data, aov_p),
           <span class="dt">tukey =</span> <span class="kw">map</span>(data, aov_tukey)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>data)
  <span class="kw">return</span>(res)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This file is not uploaded to GitHub as it is too large</span>
<span class="co"># One must first run the above code locally to generate and save the file</span>
<span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth.Rdata"</span>)
doMC<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/doMC/topics/registerDoMC">registerDoMC</a></span>(<span class="dt">cores =</span> <span class="dv">50</span>)
sst_ALL_smooth_aov_tukey &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ddply">ddply</a></span>(sst_ALL_smooth, <span class="kw">c</span>(<span class="st">"rep"</span>, <span class="st">"site"</span>), 
                                        clim_aov_tukey, <span class="dt">.parallel =</span> T)
<span class="kw">save</span>(sst_ALL_smooth_aov_tukey, <span class="dt">file =</span> <span class="st">"data/sst_ALL_smooth_aov_tukey.RData"</span>)
<span class="co"># rm(sst_ALL_smooth, sst_ALL_smooth_aov_tukey)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth_aov_tukey.RData"</span>)

sst_ALL_smooth_aov &lt;-<span class="st"> </span>sst_ALL_smooth_aov_tukey <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>tukey) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>()

label_count_aov_p &lt;-<span class="st"> </span>sst_ALL_smooth_aov <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, metric) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>())

knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(label_count_aov_p, 
             <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">"Time series"</span>, <span class="st">"Climatology"</span>, <span class="st">"Significantly different"</span>), 
             <span class="dt">caption =</span> <span class="st">"Table 1: This table shows the results of 101 ANOVAs on the real and re-sampled time series with systematically shortened lengths from 37 -- 3 years. Note that the climatologies for the Med time series were never significantly different and so aren't shown here."</span>)

<span class="kw">rm</span>(sst_ALL_smooth_aov, label_count_aov_p)</code></pre></div>
<p>The above figure shows that there are no significant differences in the climatologies for the Mediterannean and relatively few for the North West Atlantic time series. We do however see that of the 100 re-samples for the Western Australia time series, 54 of the seasonal signals and 84 of the thresholds did differ significantly at some point during the shortening.</p>
</div>
<div id="post-hoc-tukey-test" class="section level3">
<h3 class="hasAnchor">
<a href="#post-hoc-tukey-test" class="anchor"></a>Post-hoc Tukey test</h3>
<p>To get a more precise pictures of where these differences are occurring we will need to look at the post-hoc Tukey test results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sst_ALL_smooth_tukey &lt;-<span class="st"> </span>sst_ALL_smooth_aov_tukey <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>aov) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>()

clim_tukey_sig &lt;-<span class="st"> </span>sst_ALL_smooth_tukey <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(adj.p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(comparison, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">"year_long"</span>, <span class="st">"year_short"</span>), <span class="dt">sep =</span> <span class="st">"-"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_long =</span> <span class="kw">as.numeric</span>(year_long),
         <span class="dt">year_short =</span> <span class="kw">as.numeric</span>(year_short)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_dif =</span> year_long <span class="op">-</span><span class="st"> </span>year_short) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># select(-adj.p.value, -rep) %&gt;% </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, metric, year_long, year_short, year_dif) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>year_long, <span class="op">-</span>year_dif) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> <span class="kw">factor</span>(<span class="kw">paste0</span>(year_long,<span class="st">"-"</span>,year_dif)),
         <span class="dt">year_index =</span> <span class="kw">factor</span>(year_index, <span class="dt">levels =</span> <span class="kw">unique</span>(year_index)))
<span class="co"># levels(clim_tukey_sig$year_index)</span>

<span class="kw">ggplot</span>(clim_tukey_sig, <span class="kw">aes</span>(<span class="dt">x =</span> year_long, <span class="dt">y =</span> year_short)) <span class="op">+</span>
<span class="st">  </span><span class="co"># geom_point() +</span>
<span class="st">  </span><span class="co"># geom_errorbarh(aes(xmin = year_long, xmax = year_short)) +</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> count)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(metric<span class="op">~</span>site) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_reverse</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">3</span>, <span class="dv">36</span>, <span class="dv">3</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_reverse</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">4</span> , <span class="dv">16</span>, <span class="dv">2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_c</span>(<span class="st">"count out of </span><span class="ch">\n</span><span class="st">101 re-samples"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Length (years) of long time series"</span>,
       <span class="dt">y =</span> <span class="st">"Length (years) of short time series"</span>)

<span class="kw">rm</span>(sst_ALL_smooth_aov_tukey, sst_ALL_smooth_tukey, clim_tukey_sig)</code></pre></div>
<p>The above figure shows us that as few as a four year difference in time series length was able to create significantly different thresholds, but that the most common difference was 14 – 17 years with the distribution left-skewed.</p>
</div>
<div id="kolmogorov-smirnov-tests" class="section level3">
<h3 class="hasAnchor">
<a href="#kolmogorov-smirnov-tests" class="anchor"></a>Kolmogorov-Smirnov tests</h3>
<p>Whereas the above figure does reveal to us that shorter time series are more often significantly different than longer time series, it takes quie a while to decipher this information and it doesn’t seem very helpful to know this level of detail. Rather I think it would be more useful to simply run a series of Kolmogorov-Smirnov tests for each length of each re-sampled time series to see how often the climatology distributions are significantly different from the climatologies at the 30 year length. This is not only a more appropriate test for these climatology data than an ANOVA, it is also a more simplified way of understanding the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth.Rdata"</span>)

<span class="co"># Extract climatology values only</span>
sst_ALL_clim_only &lt;-<span class="st"> </span>sst_ALL_smooth <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(rep<span class="op">:</span>doy, seas<span class="op">:</span>thresh) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(site, rep, <span class="op">-</span>year_index, doy)

<span class="kw">save</span>(sst_ALL_clim_only, <span class="dt">file =</span> <span class="st">"data/sst_ALL_clim_only.Rdata"</span>)
<span class="kw">rm</span>(sst_ALL_smooth, sst_ALL_clim_only)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_clim_only.Rdata"</span>)

<span class="co"># Function for running a pairwise KS test against the </span>
KS_sub &lt;-<span class="st"> </span><span class="cf">function</span>(df_<span class="dv">2</span>, df_<span class="dv">1</span>){
  <span class="kw">suppressWarnings</span>( <span class="co"># Suppress warnings about perfect matches</span>
  res &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">seas =</span> <span class="kw">round</span>(<span class="kw">ks.test</span>(df_<span class="dv">1</span><span class="op">$</span>seas, df_<span class="dv">2</span><span class="op">$</span>seas)<span class="op">$</span>p.value, <span class="dv">4</span>),
                    <span class="dt">thresh =</span> <span class="kw">round</span>(<span class="kw">ks.test</span>(df_<span class="dv">1</span><span class="op">$</span>thresh, df_<span class="dv">2</span><span class="op">$</span>thresh)<span class="op">$</span>p.value, <span class="dv">4</span>),
                    <span class="dt">year_1 =</span> df_<span class="dv">1</span><span class="op">$</span>year_index[<span class="dv">1</span>],
                    <span class="dt">year_2 =</span> df_<span class="dv">2</span><span class="op">$</span>year_index[<span class="dv">1</span>])
  )
  <span class="kw">return</span>(res)
}

<span class="co"># Wrapper function to run all pairwise KS tests</span>
df &lt;-<span class="st"> </span>sst_ALL_clim_only <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(rep <span class="op">==</span><span class="st"> "30"</span>, site <span class="op">==</span><span class="st"> "WA"</span>)
KS_all &lt;-<span class="st"> </span><span class="cf">function</span>(df){
  
  <span class="co"># The 30 year clims against which all are compared</span>
  df_<span class="dv">30</span> &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(year_index <span class="op">==</span><span class="st"> </span><span class="dv">30</span>)
  
  <span class="co"># The results</span>
  res &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index2 =</span> year_index) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(year_index2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">KS =</span> <span class="kw">map</span>(data, KS_sub, <span class="dt">df_1 =</span> df_<span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>data, <span class="op">-</span>year_index2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="dt">key =</span> <span class="st">"metric"</span>, <span class="dt">value =</span> <span class="st">"p.value"</span>, <span class="op">-</span>year_<span class="dv">1</span>, <span class="op">-</span>year_<span class="dv">2</span>)
  <span class="kw">return</span>(res)
}

doMC<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/doMC/topics/registerDoMC">registerDoMC</a></span>(<span class="dt">cores =</span> <span class="dv">50</span>)
sst_ALL_KS &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ddply">ddply</a></span>(sst_ALL_clim_only, KS_all, 
                          <span class="dt">.variables =</span> <span class="kw">c</span>(<span class="st">"rep"</span>, <span class="st">"site"</span>), <span class="dt">.parallel =</span> T)
<span class="kw">save</span>(sst_ALL_KS, <span class="dt">file =</span> <span class="st">"data/sst_ALL_KS.Rdata"</span>)
<span class="kw">rm</span>(sst_ALL_clim_only, sst_ALL_KS)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_KS.Rdata"</span>)

<span class="co"># Filter non-significant results</span>
KS_sig &lt;-<span class="st"> </span>sst_ALL_KS <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, metric, year_<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()

<span class="co"># Pad in NA for years with no significant differences</span>
KS_sig &lt;-<span class="st"> </span>padr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/padr/topics/pad_int">pad_int</a></span>(<span class="dt">x =</span> KS_sig, <span class="dt">by =</span> <span class="st">"year_2"</span>, <span class="dt">group =</span> <span class="kw">c</span>(<span class="st">"site"</span>, <span class="st">"metric"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(site, metric, year_<span class="dv">2</span>, count) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">site =</span> <span class="st">"Med"</span>, <span class="dt">metric =</span> <span class="st">"seas"</span>, <span class="dt">year_2 =</span> <span class="dv">25</span><span class="op">:</span><span class="dv">37</span>, <span class="dt">count =</span> <span class="ot">NA</span>))

<span class="kw">ggplot</span>(KS_sig, <span class="kw">aes</span>(<span class="dt">x =</span> year_<span class="dv">2</span>, <span class="dt">y =</span> site)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> count)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">30</span>), <span class="dt">alpha =</span> <span class="fl">0.7</span>, <span class="dt">linetype =</span> <span class="st">"dotted"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>metric, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_viridis_c</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_reverse</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">35</span>, <span class="dv">5</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Climatology period (years)"</span>, 
       <span class="dt">y =</span> <span class="ot">NULL</span>,
       <span class="dt">colour =</span> <span class="st">"Sig. dif.</span><span class="ch">\n</span><span class="st">out of 101"</span>)
  
<span class="kw">rm</span>(sst_ALL_KS, KS_sig)</code></pre></div>
<p>The above figure shows that the results of the KS tests were more often significantly different than the ANOVAs. This means that the actual shape of the distributions changes rather quicklky, as shown by how it only takes a few years for the KS test to show the results as being different. The ANOVAs report fewer significant differences because that is a test of central tendency. Meaning that the shape of the climatologies changes rather quickly depending on the climatology period used, but the overall range of values within a climatology does not differ significantly as quickly.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_clim_only.Rdata"</span>)

sst_ALL_clim_<span class="dv">0</span> &lt;-<span class="st"> </span>sst_ALL_clim_only <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(rep <span class="op">==</span><span class="st"> "0"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(year_index)

<span class="kw">ggplot</span>(<span class="dt">data =</span> sst_ALL_clim_<span class="dv">0</span>, <span class="kw">aes</span>(<span class="dt">x =</span> doy, <span class="dt">y =</span> thresh)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> year_index, <span class="dt">colour =</span> year_index), <span class="dt">alpha =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>site, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_viridis_c</span>()</code></pre></div>
<p>The above figure shows us that the larger the seasonal signal is, the less effect deviations away from it will likely have.</p>
</div>
<div id="correlations" class="section level3">
<h3 class="hasAnchor">
<a href="#correlations" class="anchor"></a>Correlations</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth.Rdata"</span>)
<span class="co"># Summary stats for correlation</span>
sst_ALL_smooth_cor_base &lt;-<span class="st"> </span>sst_ALL_smooth <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(rep, site, year_index, temp, seas, thresh) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(rep, site, year_index) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">temp_sd =</span> <span class="kw">sd</span>(temp, <span class="dt">na.rm =</span> T),
            <span class="dt">seas_mean =</span> <span class="kw">mean</span>(seas),
            <span class="dt">seas_sd =</span> <span class="kw">sd</span>(seas),
            <span class="dt">thresh_mean =</span> <span class="kw">mean</span>(thresh),
            <span class="dt">thresh_sd =</span> <span class="kw">sd</span>(thresh)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># select(-year_index) %&gt;% </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(rep, site)
<span class="kw">save</span>(sst_ALL_smooth_cor_base, <span class="dt">file =</span> <span class="st">"data/sst_ALL_smooth_cor_base.RData"</span>)
<span class="kw">rm</span>(sst_ALL_smooth, sst_ALL_smooth_cor_base)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth_cor_base.RData"</span>)

<span class="co"># library(corrr)</span>
sst_ALL_smooth_cor_length &lt;-<span class="st"> </span>sst_ALL_smooth_cor_base <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">cor</span>(.[,<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>], .[,<span class="dv">3</span>])))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> y, <span class="dt">value =</span> r, <span class="op">-</span>rep, <span class="op">-</span>site) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">x =</span> <span class="st">"length"</span>)

sst_ALL_smooth_cor_sd &lt;-<span class="st"> </span>sst_ALL_smooth_cor_base <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">cor</span>(.[,<span class="kw">c</span>(<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>)], .[,<span class="dv">4</span>])))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> y, <span class="dt">value =</span> r, <span class="op">-</span>rep, <span class="op">-</span>site) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">x =</span> <span class="st">"sd"</span>)

sst_ALL_smooth_cor &lt;-<span class="st"> </span><span class="kw">rbind</span>(sst_ALL_smooth_cor_length, sst_ALL_smooth_cor_sd)

<span class="kw">ggplot</span>(sst_ALL_smooth_cor, <span class="kw">aes</span>(<span class="dt">x =</span> y, <span class="dt">y =</span> r, <span class="dt">fill =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(site<span class="op">~</span>x)

<span class="kw">rm</span>(sst_ALL_smooth_cor, sst_ALL_smooth_cor_base, sst_ALL_smooth_cor_length, sst_ALL_smooth_cor_sd)</code></pre></div>
<p>The above figure shows us that all three reference time series respond relatively similarly with regards to the correlations of their climatology means and SD to the length and SD of the base temperatures from which the climatologies were derived. Though the patterns observed otherwise tell us little, it is an important finding to know that this dud pattern is consistent across the different reference time series. The other important pattern this figure shows is that the length of a time series appears to not have a consistent relationship with the resultant climatologies. Instead we see that it is the variance in the time series that tends to have a positive relationship with the variance, and to a lesser extent the means, in the climatologies.</p>
<p>The pattern that is beginning to emerge from the results for the climatologies is that what matters most for the difference in the results is how much variance is present in the base time series, meaning how large is the seasonal signal relative to the temperatures in the time series. This variance could also be a representation of the presence of extreme temperature differences. Relating to the reseach question here this means large MHWs. It must therefore be investigated what the relationship is between categories of MHWs and the significant differences detected in the thresholds in the WA time series. It should also be taken into consideration that whenever the re-sampled time series have the year 2011, the massive MHW, these will likely be the ones producing significantly different results.</p>
</div>
</div>
<div id="mhw-metrics" class="section level2">
<h2 class="hasAnchor">
<a href="#mhw-metrics" class="anchor"></a>MHW metrics</h2>
<p>With the effects of time series duration on the climatologies now mapped out it is time to apply a similar methodology to the MHW metrics. In order to produce more robust statistics we will now use only results from time series of lengths 37 –10 years and will only compare events that occurred in the most recent 10 years of each time series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Quick wrapper for getting results for ANOVA on events</span>
<span class="co"># df &lt;- sst_ALL_smooth %&gt;%</span>
<span class="co">#   filter(rep == "1", site == "WA") %&gt;%</span>
<span class="co">#   select(-rep, -site)</span>
event_aov_tukey &lt;-<span class="st"> </span><span class="cf">function</span>(df){
  res &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(year_index <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(date_start <span class="op">&gt;=</span><span class="st"> "2009-01-02"</span>, date_end <span class="op">&lt;=</span><span class="st"> "2018-12-31"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(year_index, duration, intensity_mean, intensity_max, intensity_cumulative) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> <span class="kw">as.factor</span>(year_index)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">aov =</span> <span class="kw">map</span>(data, aov_p),
           <span class="dt">tukey =</span> <span class="kw">map</span>(data, aov_tukey)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>data)
  <span class="kw">return</span>(res)
}</code></pre></div>
<div id="anova-p-values-1" class="section level3">
<h3 class="hasAnchor">
<a href="#anova-p-values-1" class="anchor"></a>ANOVA <em>p</em>-values</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth.Rdata"</span>)
doMC<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/doMC/topics/registerDoMC">registerDoMC</a></span>(<span class="dt">cores =</span> <span class="dv">50</span>)
sst_ALL_event_aov_tukey &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/plyr/topics/ddply">ddply</a></span>(sst_ALL_smooth, <span class="kw">c</span>(<span class="st">"rep"</span>, <span class="st">"site"</span>), event_aov_tukey, <span class="dt">.parallel =</span> T)
<span class="kw">save</span>(sst_ALL_event_aov_tukey, <span class="dt">file =</span> <span class="st">"data/sst_ALL_event_aov_tukey.RData"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This file is not uploaded to GitHub as it is too large</span>
<span class="co"># One must first run the above code locally to generate and save the file</span>
<span class="kw">load</span>(<span class="st">"data/sst_ALL_event_aov_tukey.RData"</span>)

sst_ALL_event_aov &lt;-<span class="st"> </span>sst_ALL_event_aov_tukey <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>tukey) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>()

label_count_event_aov_p &lt;-<span class="st"> </span>sst_ALL_event_aov <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, metric) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>())

knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(label_count_event_aov_p, 
             <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">"Time series"</span>, <span class="st">"MHW metric"</span>, <span class="st">"Significantly different"</span>), 
             <span class="dt">caption =</span> <span class="st">"Table 1: This table shows the results of 101 ANOVAs on event metrics detected in the real and re-sampled time series with systematically shortened lengths from 37 -- 10 years."</span>)</code></pre></div>
<p>The above table shows us that generally the length of a time series has no significant effect on the MHWs detected within it. We see that the MHWs in the Mediterranean time series are not affected at all in any of the 101 replicates. Surprisingly the events in the North West Atlantic time series are significantly different more often than the Western Australia time series. This must mean that the event metrics are more sensistive to a number of longer larger events than a single large one, as is the case in the WA time series. This also means that the thresholds between shortened time series may not need to be significantly different in order to produce significantly different events. It must now be investigate just which years are significantly different from one another.</p>
</div>
<div id="post-hoc-tukey-test-1" class="section level3">
<h3 class="hasAnchor">
<a href="#post-hoc-tukey-test-1" class="anchor"></a>Post-hoc Tukey test</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sst_ALL_event_tukey &lt;-<span class="st"> </span>sst_ALL_event_aov_tukey <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>aov) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>()

event_tukey_sig &lt;-<span class="st"> </span>sst_ALL_event_tukey <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(adj.p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(comparison, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">"year_long"</span>, <span class="st">"year_short"</span>), <span class="dt">sep =</span> <span class="st">"-"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_long =</span> <span class="kw">as.numeric</span>(year_long),
         <span class="dt">year_short =</span> <span class="kw">as.numeric</span>(year_short)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_dif =</span> year_long <span class="op">-</span><span class="st"> </span>year_short) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># select(-adj.p.value, -rep) %&gt;% </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, metric, year_long, year_short, year_dif) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>year_long, <span class="op">-</span>year_dif) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> <span class="kw">factor</span>(<span class="kw">paste0</span>(year_long,<span class="st">"-"</span>,year_dif)),
         <span class="dt">year_index =</span> <span class="kw">factor</span>(year_index, <span class="dt">levels =</span> <span class="kw">unique</span>(year_index)))

<span class="co"># ggplot(event_tukey_sig, aes(x = year_long, y = year_short)) +</span>
<span class="co">#   # geom_point() +</span>
<span class="co">#   # geom_errorbarh(aes(xmin = year_long, xmax = year_short)) +</span>
<span class="co">#   geom_tile(aes(fill = count)) +</span>
<span class="co">#   facet_grid(~metric) +</span>
<span class="co">#   scale_x_reverse(breaks = seq(3, 36, 3)) +</span>
<span class="co">#   scale_y_reverse(breaks = seq(3 , 7, 1)) +</span>
<span class="co">#   scale_fill_viridis_c("count out of \n101 re-samples", breaks = seq(2,12,2)) +</span>
<span class="co">#   labs(x = "Length (years) of long time series",</span>
<span class="co">#        y = "Length (years) of short time series")</span></code></pre></div>
<p>The post-hoc Tukey test revealed that no individual pairings of years profuced significantly different event metrics. This is a bit of a surprise and will require a more in depth analysis.</p>
</div>
<div id="correlations-1" class="section level3">
<h3 class="hasAnchor">
<a href="#correlations-1" class="anchor"></a>Correlations</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth.Rdata"</span>)

sst_ALL_event_cor &lt;-<span class="st"> </span>sst_ALL_smooth <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>(events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year_index <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(date_start <span class="op">&gt;=</span><span class="st"> "2009-01-01"</span>, date_end <span class="op">&lt;=</span><span class="st"> "2018-12-31"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(rep, site, year_index, duration, intensity_mean, intensity_max, intensity_cumulative) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, rep, year_index) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> <span class="kw">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, rep) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">data.frame</span>(<span class="kw">t</span>(<span class="kw">cor</span>(.[,<span class="dv">4</span><span class="op">:</span><span class="dv">11</span>], .[,<span class="dv">3</span>])))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> y, <span class="dt">value =</span> r, <span class="op">-</span>rep, <span class="op">-</span>site) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">x =</span> <span class="st">"length"</span>)

<span class="kw">save</span>(sst_ALL_event_cor, <span class="dt">file =</span> <span class="st">"data/sst_ALL_event_cor.Rdata"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_event_cor.Rdata"</span>)

<span class="kw">ggplot</span>(sst_ALL_event_cor, <span class="kw">aes</span>(<span class="dt">x =</span> y, <span class="dt">y =</span> r, <span class="dt">fill =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>), <span class="dt">colour =</span> <span class="st">"grey20"</span>,
             <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">linetype =</span> <span class="st">"dashed"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>site, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="st">"Pearson r"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.position =</span> <span class="st">"bottom"</span>)</code></pre></div>
<p>The figure above shows us that the relationship between the length of all three reference time series and the resultant MHW metrics are similar. Specifically we see that mean duration and intensities of events has a strong (r~-0.5) relationship to the length of the time series. Meaning that longer the climatology period used is, the shorter and less intense MHWs tend to be. This wasto be expected as the original hypothesis was that longer time series would have lower/smoother thresholds and so events detected with them would be longer and more intense. This pattern is a bit less clear for mean intensities.</p>
</div>
<div id="confidence-intervals" class="section level3">
<h3 class="hasAnchor">
<a href="#confidence-intervals" class="anchor"></a>Confidence intervals</h3>
<p>After looking at these correlations it seems as though somehow calculating confidence intervals on something would be worthwhile…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate CIs using a bootstrapping technique to deal with the non-normal small sample sizes</span>
<span class="co"># df &lt;- sst_ALL_both_event %&gt;%</span>
<span class="co">#   filter(lubridate::year(date_peak) &gt;= 2012,</span>
<span class="co">#          site == "WA",</span>
<span class="co">#          trend == "detrended") %&gt;%</span>
<span class="co">#   select(year_index, duration, intensity_mean, intensity_max, intensity_cumulative) #%&gt;%</span>
  <span class="co"># select(site, trend, year_index, duration, intensity_mean, intensity_max, intensity_cumulative) #%&gt;%   </span>
  <span class="co"># nest(-site, -trend)</span>
Bmean &lt;-<span class="st"> </span><span class="cf">function</span>(data, indices) {
  d &lt;-<span class="st"> </span>data[indices] <span class="co"># allows boot to select sample </span>
    <span class="kw">return</span>(<span class="kw">mean</span>(d))
} 

event_aov_CI &lt;-<span class="st"> </span><span class="cf">function</span>(df){
  df_conf &lt;-<span class="st"> </span><span class="kw">gather</span>(df, <span class="dt">key =</span> <span class="st">"metric"</span>, <span class="dt">value =</span> <span class="st">"value"</span>, <span class="op">-</span>year_index) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(year_index, metric) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="co"># ggplot(aes(x = value)) +</span>
<span class="st">    </span><span class="co"># geom_histogram(aes(fill = metric)) +</span>
<span class="st">    </span><span class="co"># facet_wrap(~metric, scales = "free_x")</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">lower =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/boot/topics/boot.ci">boot.ci</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/boot/topics/boot">boot</a></span>(<span class="dt">data=</span>value, <span class="dt">statistic=</span>Bmean, <span class="dt">R=</span><span class="dv">1000</span>), 
                              <span class="dt">type =</span> <span class="st">"basic"</span>)<span class="op">$</span>basic[<span class="dv">4</span>],
              <span class="dt">mid =</span> <span class="kw">mean</span>(value),
              <span class="dt">upper =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/boot/topics/boot.ci">boot.ci</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/boot/topics/boot">boot</a></span>(<span class="dt">data=</span>value, <span class="dt">statistic=</span>Bmean, <span class="dt">R=</span><span class="dv">1000</span>), 
                              <span class="dt">type =</span> <span class="st">"basic"</span>)<span class="op">$</span>basic[<span class="dv">5</span>],
              <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate_if</span>(is.numeric, round, <span class="dv">4</span>)
  <span class="kw">return</span>(df_conf)
  }</code></pre></div>
</div>
</div>
<div id="categories" class="section level2">
<h2 class="hasAnchor">
<a href="#categories" class="anchor"></a>Categories</h2>
<p>In this section we want to look at how the categories in the different time periods compare. I’ll start out with doing basic calculations and comparisons of the categories of events with the different time periods. After that we will run <em>chi</em>-squared tests. Lastly a post-hoc test of sorts will be used to pull out exactly which categories differ significantly in count with different time series lengths.</p>
<div id="event-count" class="section level3">
<h3 class="hasAnchor">
<a href="#event-count" class="anchor"></a>Event count</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth.Rdata"</span>)

<span class="kw">suppressWarnings</span>(
  sst_ALL_category &lt;-<span class="st"> </span>sst_ALL_smooth <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>events) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">unnest</span>(cats) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(year_index <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>,
           peak_date <span class="op">&gt;=</span><span class="st"> "2009-01-01"</span>, peak_date <span class="op">&lt;=</span><span class="st"> "2018-12-31"</span>)
)

<span class="co"># Indeed... but how to compare qualitative data?</span>
<span class="co"># Let's start out by counting the occurrence of the categories</span>
sst_ALL_clim_category_count &lt;-<span class="st"> </span>sst_ALL_category <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, rep, year_index, category) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">category =</span> <span class="kw">factor</span>(category,
                           <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">"I Moderate"</span>, <span class="st">"II Strong"</span>,
                                      <span class="st">"III Severe"</span>, <span class="st">"IV Extreme"</span>)))
<span class="kw">save</span>(sst_ALL_clim_category_count, <span class="dt">file =</span> <span class="st">"data/sst_ALL_clim_category_count.Rdata"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_clim_category_count.Rdata"</span>)

<span class="co"># total_category_count &lt;- sst_ALL_clim_category_count %&gt;% </span>
<span class="co">#   ungroup() %&gt;% </span>
<span class="co">#   select(-rep) %&gt;% </span>
<span class="co">#   group_by(site, category) %&gt;% </span>
<span class="co">#   summarise(count = sum(count))</span>

<span class="kw">ggplot</span>(sst_ALL_clim_category_count, <span class="kw">aes</span>(<span class="dt">x =</span> year_index, <span class="dt">y =</span> count, <span class="dt">fill =</span> category)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># geom_label(data = label_category_count, show.legend = F, fill = "white",</span>
<span class="st">  </span><span class="co">#           aes(label = count, y = 1000)) +</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> MHW_colours) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>site, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Tim series length (years)"</span>, <span class="dt">y =</span> <span class="st">"Total count"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>)</code></pre></div>
<p>The results in the figure above show that we see more larger events when the climatologies are based on 30 years of data, rather than 10, but that we tend to see more events overall when we use only 10 years of data. This is about what would be expected if there were a trend present in the data. SO it is interesting that it still comes through.</p>
</div>
<div id="chi-squared" class="section level3">
<h3 class="hasAnchor">
<a href="#chi-squared" class="anchor"></a><em>chi</em>-squared</h3>
<p>In this section we will use pairwise chi-squared tests to see if the count of events in the different re-sampled lengths differ significantly from the same re-sampled time series of 30 years (this serves as the control). We will combine categories 3 and 4 together into one category for a more robust test and because we are interested in how these larger events stand out together against the smaller events.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load and extract category data</span>
<span class="kw">load</span>(<span class="st">"data/sst_ALL_smooth.Rdata"</span>)
<span class="kw">suppressWarnings</span>( <span class="co"># Suppress warning about category levels not all being present</span>
sst_ALL_cat &lt;-<span class="st"> </span>sst_ALL_smooth <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>events) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unnest</span>()
)

<span class="co"># Prep the data for better chi-squared use</span>
sst_ALL_cat_prep &lt;-<span class="st"> </span>sst_ALL_cat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year_index <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>,
         peak_date <span class="op">&gt;=</span><span class="st"> "2009-01-01"</span>, peak_date <span class="op">&lt;=</span><span class="st"> "2018-12-31"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(year_index, rep, site, category) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">category =</span> <span class="kw">ifelse</span>(category <span class="op">==</span><span class="st"> "III Severe"</span>, <span class="st">"III &amp; IV"</span>, category),
         <span class="dt">category =</span> <span class="kw">ifelse</span>(category <span class="op">==</span><span class="st"> "IV Extreme"</span>, <span class="st">"III &amp; IV"</span>, category))

<span class="co"># Extract the true climatologies</span>
sst_ALL_cat_only_<span class="dv">30</span> &lt;-<span class="st"> </span>sst_ALL_cat_prep <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year_index <span class="op">==</span><span class="st"> </span><span class="dv">30</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(site, year_index, rep, category)

<span class="co"># chi-squared pairwise function</span>
<span class="co"># Takes one rep of missing data and compares it against the complete data</span>
<span class="co"># df &lt;- sst_ALL_miss_cat_prep %&gt;%</span>
  <span class="co"># filter(site == "WA", rep == "20", miss == 0.1)</span>
<span class="co"># df &lt;- unnest(slice(sst_ALL_miss_cat_chi,1)) %&gt;% </span>
  <span class="co"># select(-site2, -rep, -miss2)</span>
chi_pair &lt;-<span class="st"> </span><span class="cf">function</span>(df){
  <span class="co"># Prep data</span>
  df_comp &lt;-<span class="st"> </span>sst_ALL_cat_only_<span class="dv">30</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(site <span class="op">==</span><span class="st"> </span>df<span class="op">$</span>site[<span class="dv">1</span>],
           rep <span class="op">==</span><span class="st"> </span>df<span class="op">$</span>rep[<span class="dv">1</span>])
  df_joint &lt;-<span class="st"> </span><span class="kw">rbind</span>(df, df_comp)
  <span class="co"># Run tests</span>
  res &lt;-<span class="st"> </span><span class="kw">chisq.test</span>(<span class="kw">table</span>(df_joint<span class="op">$</span>year_index, df_joint<span class="op">$</span>category), <span class="dt">correct =</span> <span class="ot">FALSE</span>)
  res_broom &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/augment">augment</a></span>(res) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">p.value =</span> broom<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a></span>(res)<span class="op">$</span>p.value)
  <span class="kw">return</span>(res_broom)
}

<span class="co"># The pairwise chai-squared results</span>
<span class="kw">suppressWarnings</span>( <span class="co"># Suppress poor match warnings</span>
sst_ALL_cat_chi &lt;-<span class="st"> </span>sst_ALL_cat_prep <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year_index <span class="op">!=</span><span class="st"> </span><span class="dv">30</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># mutate(miss = as.factor(miss)) %&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">site2 =</span> site,
         <span class="dt">year_index2 =</span> year_index,
         <span class="dt">rep2 =</span> rep) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site2, year_index2, rep2) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">chi =</span> <span class="kw">map</span>(data, chi_pair)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">site =</span> site2, <span class="dt">year_index =</span> year_index2, <span class="dt">rep =</span> rep2,
                <span class="dt">year_comp =</span> Var1, <span class="dt">category =</span> Var2)
)
<span class="kw">save</span>(sst_ALL_cat_chi, <span class="dt">file =</span> <span class="st">"data/sst_ALL_cat_chi.Rdata"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_cat_chi.Rdata"</span>)

sst_ALL_cat_chi_sig &lt;-<span class="st"> </span>sst_ALL_cat_chi <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(site, year_index, p.value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, year_index) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>())

knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(sst_ALL_cat_chi_sig, <span class="dt">caption =</span> <span class="st">"Table showing the count out of 100 for significant differences (_p_-value) for the count of different categories of events for each site based on the amount of missing data present."</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">"data/sst_ALL_cat_chi.Rdata"</span>)

<span class="co"># Prep data for plotting</span>
chi_sig &lt;-<span class="st"> </span>sst_ALL_cat_chi <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(site, year_index, p.value) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, year_index) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>())

<span class="kw">ggplot</span>(chi_sig, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(year_index), <span class="dt">y =</span> site)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> count, <span class="dt">group =</span> site)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> count)) <span class="op">+</span>
<span class="st">  </span><span class="co"># facet_wrap(~metric, ncol = 1) +</span>
<span class="st">  </span><span class="kw">scale_colour_viridis_c</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_reverse</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Time series length (years)"</span>, <span class="dt">y =</span> <span class="ot">NULL</span>,
       <span class="dt">colour =</span> <span class="st">"Sig. dif.</span><span class="ch">\n</span><span class="st">out of 100"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">20</span>))</code></pre></div>
<p>The line plot above shows at what point the category counts begin to differ significantly from the matching 30 year time series. It was expected that the <code>WA</code> time series would show sig. dif. more quickly than the other two, though I had expected the <code>Med</code> to be the slowest to change, not the <code>NW_Atl</code>. Over a sample of 100, there were never more than five replicates showing significant differences in count of categories though so it is relatively safe to say that the length of a time series has little effect on the count of events.</p>
</div>
<div id="post-hoc-chi-squared" class="section level3">
<h3 class="hasAnchor">
<a href="#post-hoc-chi-squared" class="anchor"></a>Post-hoc <em>chi</em>-squared</h3>
<p>It is also necessary to see which of the categories specifically are differing significantly. Unfortunately there is no proper post-hoc <em>chi</em>-squared test. Instead it is possible to look at the standardised residuals for each category within the pairwise comparisons being made.</p>
<p>I still need to do this…</p>
</div>
<div id="correlations-2" class="section level3">
<h3 class="hasAnchor">
<a href="#correlations-2" class="anchor"></a>Correlations</h3>
<p>It would also be useful to look at the correlations between consecutive missing days of data and significantly different counts of categories.</p>
</div>
</div>
<div id="can-we-fix-it" class="section level2">
<h2 class="hasAnchor">
<a href="#can-we-fix-it" class="anchor"></a>Can we fix it?</h2>
<div id="fourier-transform-climatologies" class="section level3">
<h3 class="hasAnchor">
<a href="#fourier-transform-climatologies" class="anchor"></a>Fourier transform climatologies</h3>
<p>Lastly we will now go about reproducing all of the checks made above, but based on a climatology derived from a Fourier transformation, and not the default climatology creation method.</p>
<p>(RWS: I’ve not gotten to the Fourier transformations yet either. I’m also not convinced that this is going to be the way forward. I am thinking that it may be better to just increase the smoothing window width to produce a more sinusoidal climatology line. But I suppose that in order to know that it must be tested.)</p>
<p>(ECJO)[One advantage of the Fourier transform method (or, I think equivalently harmonic regression) is that it is VERY fast. Much faster than the method used in the MHW code. I also think you can probably get away with shorter time series using this method than with the “standard MHW climatology” method]</p>
<p>(RWS)[I suppose then that I will need to look into this.]</p>
</div>
<div id="wider-windows" class="section level3">
<h3 class="hasAnchor">
<a href="#wider-windows" class="anchor"></a>Wider windows</h3>
<p>Talk a bit here about changing the arguments for climatology creation to get them closer to the control.</p>
</div>
</div>
<div id="best-practices" class="section level2">
<h2 class="hasAnchor">
<a href="#best-practices" class="anchor"></a>Best practices</h2>
<p>(RWS: I envision this last section distilling everything learned above into a nice bullet list. These bulletted items for each different vignette would then all be added up in one central <a href="https://robwschlegel.github.io/MHWdetection/articles/best_practices.html">best practices</a> vignette that would be ported over into the final write-up in the discussion/best-practices section of the paper. Ideally these best-practices could also be incorporated into the R/python distributions of the MHW detection code to allow users to make use of the findings from the paper in their own work.)</p>
<div id="options-for-improving-climatology-precision-in-short-time-series" class="section level3">
<h3 class="hasAnchor">
<a href="#options-for-improving-climatology-precision-in-short-time-series" class="anchor"></a>Options for improving climatology precision in short time series</h3>
</div>
<div id="options-for-improving-mhw-metric-precision-in-short-time-series" class="section level3">
<h3 class="hasAnchor">
<a href="#options-for-improving-mhw-metric-precision-in-short-time-series" class="anchor"></a>Options for improving MHW metric precision in short time series</h3>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Oliver2018">
<p>Oliver, Eric C.J., Markus G. Donat, Michael T. Burrows, Pippa J. Moore, Dan A. Smale, Lisa V. Alexander, Jessica A. Benthuysen, et al. 2018. “Longer and more frequent marine heatwaves over the past century.” <em>Nature Communications</em> 9 (1). doi:<a href="https://doi.org/10.1038/s41467-018-03732-9">10.1038/s41467-018-03732-9</a>.</p>
</div>
<div id="ref-Schlegel2016">
<p>Schlegel, Robert W., and Albertus J. Smit. 2016. “Climate Change in Coastal Waters: Time Series Properties Affecting Trend Estimation.” <em>Journal of Climate</em> 29 (24): 9113–24. doi:<a href="https://doi.org/10.1175/JCLI-D-16-0014.1">10.1175/JCLI-D-16-0014.1</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#time-series-shortening">Time series shortening</a></li>
      <li><a href="#re-sampling">Re-sampling</a></li>
      <li><a href="#climatology-statistics">Climatology statistics</a></li>
      <li><a href="#mhw-metrics">MHW metrics</a></li>
      <li><a href="#categories">Categories</a></li>
      <li><a href="#can-we-fix-it">Can we fix it?</a></li>
      <li><a href="#best-practices">Best practices</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robert W. Schlegel, Eric C. J. Oliver, Alistair J. Hobday, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
