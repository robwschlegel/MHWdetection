<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assessing the effects of long-term trends • MHWdetection</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Assessing the effects of long-term trends">
<meta property="og:description" content="This vignette investigates the effects of long-term trends on the MHWs detected in a time series.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MHWdetection</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/r_vs_python.html">Python vs. R - default outputs</a>
    </li>
    <li>
      <a href="../articles/r_vs_python_arguments.html">Python vs. R - default arguments</a>
    </li>
    <li>
      <a href="../articles/r_vs_python_additional.html">Python vs. R - additional functions</a>
    </li>
    <li>
      <a href="../articles/Short_climatologies.html">Short climatologies</a>
    </li>
    <li>
      <a href="../articles/Climatologies_and_baselines.html">Alternative climatologies and baselines</a>
    </li>
    <li>
      <a href="../articles/time_series_duration.html">Effects of short time series</a>
    </li>
    <li>
      <a href="../articles/missing_data.html">Effects of missing data</a>
    </li>
    <li>
      <a href="../articles/gridded_products.html">Difference between gridded products</a>
    </li>
    <li>
      <a href="../articles/best_practices.html">Best practices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/MHWdetection">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Assessing the effects of long-term trends</h1>
                        <h4 class="author">Robert W Schlegel</h4>
            
            <h4 class="date">2019-01-23</h4>
      
      
      <div class="hidden name"><code>trend.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The following text has presently just been copy pasted from the time series duration vignette and serves as a place holder for the workflow that will be used for this vignette. It is not actually meant to be read at the moment…</p>
</div>
<div id="real-trend-vs-no-trend" class="section level2">
<h2 class="hasAnchor">
<a href="#real-trend-vs-no-trend" class="anchor"></a>Real trend vs. no trend</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(broom)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(heatwaveR)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lubridate) <span class="co"># This is intentionally activated after data.table</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(fasttime)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggpubr)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(boot)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(FNN)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(mgcv)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(doMC); doMC<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/doMC/topics/registerDoMC">registerDoMC</a></span>(<span class="dt">cores =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>The WMO recommends that the period used to create a climatology be 30 years in length, starting on the first year of a decade (e.g. 1981), however; because we are going to be running these analyses on time series of many different lengths, it will be better to use all of the years present in each as the climatology period. For example, if a time series spans 1989 – 2014, that will be the period used for calculating the climatologies. Likewise should the time series only span the years 2006 – 2014.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Remove the trend from a time series</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">detrend &lt;-<span class="st"> </span><span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  resids &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">augment</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(temp <span class="op">~</span><span class="st"> </span>t, df))</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  res &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">temp =</span> temp <span class="op">-</span><span class="st"> </span>resids<span class="op">$</span>.fitted)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(res)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co"># ggplot(sst_ALL_detrend, aes(x = t, y = temp)) +</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#   geom_point() +</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#   geom_smooth(method = "lm") +</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#   facet_wrap(~site, nrow = 3)</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co"># Calculate one specific clim period</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">ts2clm_sub &lt;-<span class="st"> </span><span class="cf">function</span>(year_index, df){</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">  res &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/heatwaveR/topics/ts2clm">ts2clm</a></span>(df, <span class="dt">climatologyPeriod =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(year_index,<span class="st">"-01-01"</span>), <span class="st">"2014-12-31"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(t) <span class="op">&gt;=</span><span class="st"> </span>year_index) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> year_index)</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(res)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">}</a>
<a class="sourceLine" id="cb2-20" data-line-number="20"></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co"># Calculate the full range of clims in a time series</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22">ts2clm_ALL &lt;-<span class="st"> </span><span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">  seq_year &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(df<span class="op">$</span>t)), </a>
<a class="sourceLine" id="cb2-24" data-line-number="24">                  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(df<span class="op">$</span>t))<span class="op">-</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2-25" data-line-number="25">  res &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/plyr/topics/ldply">ldply</a></span>(seq_year, <span class="dt">.fun =</span> ts2clm_sub, <span class="dt">.parallel =</span> T, <span class="dt">df =</span> df)</a>
<a class="sourceLine" id="cb2-26" data-line-number="26">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(res)</a>
<a class="sourceLine" id="cb2-27" data-line-number="27">}</a>
<a class="sourceLine" id="cb2-28" data-line-number="28"></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co"># Calculate decadal trends</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30">decadal_trend &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb2-31" data-line-number="31">  df2 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">date =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span>(t, <span class="st">"month"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">temp =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(temp,<span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year =</span> <span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(date),</a>
<a class="sourceLine" id="cb2-37" data-line-number="37">           <span class="dt">num =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">1</span>, <span class="kw">n</span>()))</a>
<a class="sourceLine" id="cb2-38" data-line-number="38">    dt &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(<span class="kw">gls</span>(</a>
<a class="sourceLine" id="cb2-39" data-line-number="39">      temp <span class="op">~</span><span class="st"> </span>num, <span class="dt">correlation =</span> <span class="kw">corARMA</span>(<span class="dt">form =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>year, <span class="dt">p =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb2-40" data-line-number="40">      <span class="dt">method =</span> <span class="st">"REML"</span>, <span class="dt">data =</span> df2, <span class="dt">na.action =</span> na.exclude))[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">120</span>), <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-41" data-line-number="41">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(dt)</a>
<a class="sourceLine" id="cb2-42" data-line-number="42">}</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># First put all of the data together and create a site column</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">sst_ALL &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(sst_Med, sst_NW_Atl, sst_WA) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">site =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Med"</span>, <span class="st">"NW_Atl"</span>, <span class="st">"WA"</span>), <span class="dt">each =</span> <span class="dv">12053</span>))</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"># Then create a de-trended version</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">sst_ALL_detrend &lt;-<span class="st"> </span>sst_ALL <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">  </span><span class="kw">do</span>(<span class="kw">detrend</span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="st">  </span><span class="kw">as.tibble</span>(.)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co"># Then calculate all of the clims</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">## With trend left in</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">sst_ALL_clim &lt;-<span class="st"> </span>sst_ALL <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>site) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">clim =</span> <span class="kw">map</span>(data, ts2clm_ALL)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="st">  </span><span class="kw">unnest</span>()</a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">## With de-trended data</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">sst_ALL_detrend_clim &lt;-<span class="st"> </span>sst_ALL_detrend <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>site) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">clim =</span> <span class="kw">map</span>(data, ts2clm_ALL)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="st">  </span><span class="kw">unnest</span>()</a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="co">## Combine for ease later</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26">sst_ALL_both_clim &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(sst_ALL_clim, sst_ALL_detrend_clim) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">trend =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"normal"</span>, <span class="st">"detrended"</span>), <span class="dt">each =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(sst_ALL_clim)))</a>
<a class="sourceLine" id="cb3-28" data-line-number="28"></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="co"># Calculate the different decadal trends</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="co"># See Schlegel and Smit 2016 for GLS model explanation/validation</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31">sst_ALL_DT &lt;-<span class="st"> </span>sst_ALL_clim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"><span class="st">  </span><span class="co"># group_by(site) %&gt;% </span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>site) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">DT =</span> <span class="kw">map</span>(data, decadal_trend)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-36" data-line-number="36"><span class="st">  </span><span class="kw">unnest</span>() <span class="co">#%&gt;% </span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37">  <span class="co"># rename(decades = decades2)</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Quick peak at the decadal trends</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(sst_ALL_DT, <span class="dt">col.names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"site"</span>, <span class="st">"trend (°C/dec)"</span>), <span class="dt">align =</span> <span class="st">"c"</span>, </a>
<a class="sourceLine" id="cb4-3" data-line-number="3">             <span class="dt">caption =</span> <span class="st">"Table showing the decadal trends detected for the three default sites."</span>, </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">             <span class="dt">digits =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>We see in the table above that the three default time series currently being used all have decadal trends much higher than the global average of ~0.1°C.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># A clomp of functions used below</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co"># Written out here for tidiness/convenience</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># Calculate only events</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">detect_event_event &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">y =</span> temp){</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  ts_y &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/eval">eval</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">substitute</a></span>(y), df)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  df<span class="op">$</span>temp &lt;-<span class="st"> </span>ts_y</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  res &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/heatwaveR/topics/detect_event">detect_event</a></span>(df)<span class="op">$</span>event</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(res)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co"># Run an ANOVA on each metric of the combined event results and get the p-value</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13">event_aov_p &lt;-<span class="st"> </span><span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">  aov_models &lt;-<span class="st"> </span>df[ , <span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="st">"year_index"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(df))] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/aov">aov</a></span>(.x <span class="op">~</span><span class="st"> </span>df<span class="op">$</span>year_index)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="st">    </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(.), <span class="dt">.id =</span> <span class="st">'metric'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">p.value =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(p.value, <span class="dv">4</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(term <span class="op">!=</span><span class="st"> "Residuals"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="st">    </span><span class="kw">select</span>(metric, p.value)</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(aov_models)</a>
<a class="sourceLine" id="cb5-21" data-line-number="21">  }</a>
<a class="sourceLine" id="cb5-22" data-line-number="22"></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co"># Run an ANOVA on each metric and then a Tukey test</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24">event_aov_tukey &lt;-<span class="st"> </span><span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">  aov_tukey &lt;-<span class="st"> </span>df[ , <span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="st">"year_index"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(df))] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="st">    </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/TukeyHSD">TukeyHSD</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/aov">aov</a></span>(.x <span class="op">~</span><span class="st"> </span>df<span class="op">$</span>year_index))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="st">    </span><span class="kw">map_dfr</span>(<span class="op">~</span><span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/broom/topics/reexports">tidy</a></span>(.), <span class="dt">.id =</span> <span class="st">'metric'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">p.value =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(adj.p.value, <span class="dv">4</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="st">    </span><span class="co"># filter(term != "Residuals") %&gt;%</span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="st">    </span><span class="kw">select</span>(metric, comparison, adj.p.value) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="st">    </span><span class="co"># filter(adj.p.value &lt;= 0.05) %&gt;% </span></a>
<a class="sourceLine" id="cb5-32" data-line-number="32"><span class="st">    </span><span class="kw">arrange</span>(metric, adj.p.value)</a>
<a class="sourceLine" id="cb5-33" data-line-number="33">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(aov_tukey)</a>
<a class="sourceLine" id="cb5-34" data-line-number="34">  }</a>
<a class="sourceLine" id="cb5-35" data-line-number="35"></a>
<a class="sourceLine" id="cb5-36" data-line-number="36"><span class="co"># Calculate CIs using a bootstrapping technique to deal with the non-normal small sample sizes</span></a>
<a class="sourceLine" id="cb5-37" data-line-number="37"></a>
<a class="sourceLine" id="cb5-38" data-line-number="38"><span class="co"># df &lt;- sst_ALL_both_event %&gt;%</span></a>
<a class="sourceLine" id="cb5-39" data-line-number="39"><span class="co">#   filter(lubridate::year(date_peak) &gt;= 2012,</span></a>
<a class="sourceLine" id="cb5-40" data-line-number="40"><span class="co">#          site == "WA",</span></a>
<a class="sourceLine" id="cb5-41" data-line-number="41"><span class="co">#          trend == "detrended") %&gt;%</span></a>
<a class="sourceLine" id="cb5-42" data-line-number="42"><span class="co">#   select(year_index, duration, intensity_mean, intensity_max, intensity_cumulative) #%&gt;%</span></a>
<a class="sourceLine" id="cb5-43" data-line-number="43">  <span class="co"># select(site, trend, year_index, duration, intensity_mean, intensity_max, intensity_cumulative) #%&gt;%   </span></a>
<a class="sourceLine" id="cb5-44" data-line-number="44">  <span class="co"># nest(-site, -trend)</span></a>
<a class="sourceLine" id="cb5-45" data-line-number="45"></a>
<a class="sourceLine" id="cb5-46" data-line-number="46">Bmean &lt;-<span class="st"> </span><span class="cf">function</span>(data, indices) {</a>
<a class="sourceLine" id="cb5-47" data-line-number="47">  d &lt;-<span class="st"> </span>data[indices] <span class="co"># allows boot to select sample </span></a>
<a class="sourceLine" id="cb5-48" data-line-number="48">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(d))</a>
<a class="sourceLine" id="cb5-49" data-line-number="49">} </a>
<a class="sourceLine" id="cb5-50" data-line-number="50"></a>
<a class="sourceLine" id="cb5-51" data-line-number="51">event_aov_CI &lt;-<span class="st"> </span><span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb5-52" data-line-number="52">  df_conf &lt;-<span class="st"> </span><span class="kw">gather</span>(df, <span class="dt">key =</span> <span class="st">"metric"</span>, <span class="dt">value =</span> <span class="st">"value"</span>, <span class="op">-</span>year_index) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-53" data-line-number="53"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(year_index, metric) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-54" data-line-number="54"><span class="st">    </span><span class="co"># ggplot(aes(x = value)) +</span></a>
<a class="sourceLine" id="cb5-55" data-line-number="55"><span class="st">    </span><span class="co"># geom_histogram(aes(fill = metric)) +</span></a>
<a class="sourceLine" id="cb5-56" data-line-number="56"><span class="st">    </span><span class="co"># facet_wrap(~metric, scales = "free_x")</span></a>
<a class="sourceLine" id="cb5-57" data-line-number="57"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">lower =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/boot/topics/boot.ci">boot.ci</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/boot/topics/boot">boot</a></span>(<span class="dt">data=</span>value, <span class="dt">statistic=</span>Bmean, <span class="dt">R=</span><span class="dv">1000</span>), <span class="dt">type =</span> <span class="st">"basic"</span>)<span class="op">$</span>basic[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb5-58" data-line-number="58">              <span class="dt">mid =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(value),</a>
<a class="sourceLine" id="cb5-59" data-line-number="59">              <span class="dt">upper =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/boot/topics/boot.ci">boot.ci</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/boot/topics/boot">boot</a></span>(<span class="dt">data=</span>value, <span class="dt">statistic=</span>Bmean, <span class="dt">R=</span><span class="dv">1000</span>), <span class="dt">type =</span> <span class="st">"basic"</span>)<span class="op">$</span>basic[<span class="dv">5</span>],</a>
<a class="sourceLine" id="cb5-60" data-line-number="60">              <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-61" data-line-number="61"><span class="st">    </span><span class="kw">mutate_if</span>(is.numeric, round, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb5-62" data-line-number="62">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(df_conf)</a>
<a class="sourceLine" id="cb5-63" data-line-number="63">  }</a>
<a class="sourceLine" id="cb5-64" data-line-number="64"></a>
<a class="sourceLine" id="cb5-65" data-line-number="65"><span class="co"># A particular summary output</span></a>
<a class="sourceLine" id="cb5-66" data-line-number="66">event_output &lt;-<span class="st"> </span><span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb5-67" data-line-number="67">  res &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-68" data-line-number="68"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(year_index) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-69" data-line-number="69"><span class="st">    </span><span class="co"># select(-event_no) %&gt;% </span></a>
<a class="sourceLine" id="cb5-70" data-line-number="70"><span class="st">    </span><span class="kw">summarise_all</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>))</a>
<a class="sourceLine" id="cb5-71" data-line-number="71">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(res)</a>
<a class="sourceLine" id="cb5-72" data-line-number="72">}</a>
<a class="sourceLine" id="cb5-73" data-line-number="73"></a>
<a class="sourceLine" id="cb5-74" data-line-number="74"><span class="co"># Quick wrapper for getting results for ANOVA on clims</span></a>
<a class="sourceLine" id="cb5-75" data-line-number="75">clim_aov &lt;-<span class="st"> </span><span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb5-76" data-line-number="76">  res &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-77" data-line-number="77"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>t, <span class="op">-</span><span class="st"> </span>temp, <span class="op">-</span>doy) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-78" data-line-number="78"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(year_index)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-79" data-line-number="79"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-80" data-line-number="80"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, trend) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-81" data-line-number="81"><span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-82" data-line-number="82"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">res =</span> <span class="kw">map</span>(data, event_aov_p)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-83" data-line-number="83"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-84" data-line-number="84"><span class="st">    </span><span class="kw">unnest</span>()</a>
<a class="sourceLine" id="cb5-85" data-line-number="85">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(res)</a>
<a class="sourceLine" id="cb5-86" data-line-number="86">}</a>
<a class="sourceLine" id="cb5-87" data-line-number="87"></a>
<a class="sourceLine" id="cb5-88" data-line-number="88"><span class="co"># Quick wrapper for getting results for Tukey on clims</span></a>
<a class="sourceLine" id="cb5-89" data-line-number="89">clim_tukey &lt;-<span class="st"> </span><span class="cf">function</span>(df){</a>
<a class="sourceLine" id="cb5-90" data-line-number="90">  res &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-91" data-line-number="91"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>t, <span class="op">-</span><span class="st"> </span>temp, <span class="op">-</span>doy) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-92" data-line-number="92"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(year_index)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-93" data-line-number="93"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-94" data-line-number="94"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, trend) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-95" data-line-number="95"><span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-96" data-line-number="96"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">res =</span> <span class="kw">map</span>(data, event_aov_tukey)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-97" data-line-number="97"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-98" data-line-number="98"><span class="st">    </span><span class="kw">unnest</span>()</a>
<a class="sourceLine" id="cb5-99" data-line-number="99">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(res)</a>
<a class="sourceLine" id="cb5-100" data-line-number="100">}</a></code></pre></div>
<div id="climatology-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#climatology-statistics" class="anchor"></a>Climatology statistics</h3>
<div id="anova-p-values" class="section level4">
<h4 class="hasAnchor">
<a href="#anova-p-values" class="anchor"></a>ANOVA <em>p</em>-values</h4>
<p>Given that there are perceptible differences in the mean seasonal signal values between the decades of data used, let’s see if an ANOVA determines these differences to be significant.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">sst_ALL_both_clim_aov &lt;-<span class="st"> </span><span class="kw">clim_aov</span>(sst_ALL_both_clim)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">ggplot</span>(sst_ALL_both_clim_aov, <span class="kw">aes</span>(<span class="dt">x =</span> site, <span class="dt">y =</span> metric)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> p.value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(p.value, <span class="dv">2</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">midpoint =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>trend)</a></code></pre></div>
<p>We may see in the figure above that the climatologies do not differ appreciably at any length for the <code>Med</code>. The climatologies do however differ significantly for both the <code>NW_Atl</code> and the <code>WA</code> time series. Interestingly, when the long-term trend is removed (simple linear model flattening), the 90th percentile thresholds do not differ significantly at any length within the <code>NW_Atl</code> time series. It is worth pointing out that the <code>Med</code> time series has the lowest decadal warming trend of the three time series, that coupled with the decrease in significance for the difference in thresholds in the <code>NW_Atl</code> seems to imply that the decadal trend may play a role in determining the difference in the time series. Though the fact that the <code>WA</code> time series, by far the most variable of the three, always produces significant differences leads me to think that the variance of a time series may be able to win out over the long-term trend. This interaction will need to be quantified.</p>
</div>
<div id="post-hoc-tukey-test" class="section level4">
<h4 class="hasAnchor">
<a href="#post-hoc-tukey-test" class="anchor"></a>Post-hoc Tukey test</h4>
<p>Before getting to that step we need to run a post-hoc Tukey test to see where the significant differences when comparing the different time series lengths begins.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">sst_ALL_both_clim_tukey &lt;-<span class="st"> </span><span class="kw">clim_tukey</span>(sst_ALL_both_clim) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span>(<span class="dt">col =</span> comparison, <span class="dt">into =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"comp1"</span>, <span class="st">"comp2"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">comp1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(comp1), </a>
<a class="sourceLine" id="cb7-4" data-line-number="4">         <span class="dt">comp2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(comp2))</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="kw">ggplot</span>(sst_ALL_both_clim_tukey, <span class="kw">aes</span>(<span class="dt">x =</span> comp2, <span class="dt">y =</span> comp1)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> adj.p.value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(sst_ALL_both_clim_tukey, adj.p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">             <span class="dt">size =</span> <span class="fl">0.01</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="st">  </span><span class="co"># geom_text(aes(label = round(adj.p.value, 2))) +</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">midpoint =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_equal</span>(<span class="dt">expand =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_grid</span>(site<span class="op">~</span>metric<span class="op">+</span>trend) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">""</span>)</a></code></pre></div>
<p>The figure above is perhaps a bit odd, but I think a lengthy table would have been less informative. What the figure above is showing is that most time series lengths do not create significantly different results for the calculated climatologies. We also see that even with very short time series (&lt; 10 years), the calculated climatologies tend not to differ from those created from nearby years. The exception to this is the <code>WA</code> time series. We may see that the 90th percentile threshold for the three year time series (top row of pixels in the <code>WA</code> panels) differs significantly from the ~4 – 7 year time series, but then does not differ significantly from the much longer time series. This is certainly due to the massive MHW near the end of this time series. It is a good indicator of one of the perils of using such short time series; that one massive event can create significant changes in the results.</p>
</div>
<div id="kolmogorov-smirnov-tests" class="section level4">
<h4 class="hasAnchor">
<a href="#kolmogorov-smirnov-tests" class="anchor"></a>Kolmogorov-Smirnov tests</h4>
<p>Now knowing that the daily values that make up the climatologies tend to differ based on the number of years used, as seen with the ANOVA and Tukey results, we want to check where the distributions of the climatologies themselves begin to differ. We will do this through a series of pair-wise two-sample KS tests.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># Extract climatology values only</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">sst_ALL_both_clim_only &lt;-<span class="st"> </span>sst_ALL_both_clim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>t, <span class="op">-</span>temp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(site, trend, year_index, doy)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">KS_sub &lt;-<span class="st"> </span><span class="cf">function</span>(df, year_index_<span class="dv">1</span>, year_index_<span class="dv">2</span>){</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  df_<span class="dv">1</span> &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(year_index <span class="op">==</span><span class="st"> </span>year_index_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">  df_<span class="dv">2</span> &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(year_index <span class="op">==</span><span class="st"> </span>year_index_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">  res &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">seas =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/ks.test">ks.test</a></span>(df_<span class="dv">1</span><span class="op">$</span>seas, df_<span class="dv">2</span><span class="op">$</span>seas)<span class="op">$</span>p.value, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">                    <span class="dt">thresh =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/ks.test">ks.test</a></span>(df_<span class="dv">1</span><span class="op">$</span>thresh, df_<span class="dv">2</span><span class="op">$</span>thresh)<span class="op">$</span>p.value, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">                    <span class="dt">year_1 =</span> year_index_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb8-15" data-line-number="15">                    <span class="dt">year_2 =</span> year_index_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(res)</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb8-18" data-line-number="18"></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co"># The KS results</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20">sst_ALL_both_clim_KS_p &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>()</a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(sst_ALL_both_clim_only<span class="op">$</span>year_index))){</a>
<a class="sourceLine" id="cb8-22" data-line-number="22">  year_index_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(sst_ALL_both_clim_only<span class="op">$</span>year_index)[i]</a>
<a class="sourceLine" id="cb8-23" data-line-number="23">  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(sst_ALL_both_clim_only<span class="op">$</span>year_index))){</a>
<a class="sourceLine" id="cb8-24" data-line-number="24">    year_index_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(sst_ALL_both_clim_only<span class="op">$</span>year_index)[j]</a>
<a class="sourceLine" id="cb8-25" data-line-number="25">    <span class="cf">if</span>(year_index_<span class="dv">1</span> <span class="op">&lt;</span><span class="st"> </span>year_index_<span class="dv">2</span>){</a>
<a class="sourceLine" id="cb8-26" data-line-number="26">      <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/warning">suppressWarnings</a></span>(</a>
<a class="sourceLine" id="cb8-27" data-line-number="27">      res &lt;-<span class="st"> </span>sst_ALL_both_clim_only <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="st">        </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, trend) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="st">        </span><span class="kw">do</span>(<span class="kw">KS_sub</span>(., <span class="dt">year_index_1 =</span> year_index_<span class="dv">1</span>, <span class="dt">year_index_2 =</span> year_index_<span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="st">        </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"><span class="st">        </span><span class="kw">as.tibble</span>(.)</a>
<a class="sourceLine" id="cb8-32" data-line-number="32">      )</a>
<a class="sourceLine" id="cb8-33" data-line-number="33">      sst_ALL_both_clim_KS_p &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(sst_ALL_both_clim_KS_p, res)</a>
<a class="sourceLine" id="cb8-34" data-line-number="34">    }</a>
<a class="sourceLine" id="cb8-35" data-line-number="35">  }</a>
<a class="sourceLine" id="cb8-36" data-line-number="36">}</a>
<a class="sourceLine" id="cb8-37" data-line-number="37"></a>
<a class="sourceLine" id="cb8-38" data-line-number="38">sst_ALL_both_clim_KS_p_long &lt;-<span class="st"> </span>sst_ALL_both_clim_KS_p <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-39" data-line-number="39"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="dt">key =</span> <span class="st">"metric"</span>, <span class="dt">value =</span> <span class="st">"p.value"</span>, <span class="op">-</span>site, <span class="op">-</span>trend, <span class="op">-</span>year_<span class="dv">1</span>, <span class="op">-</span>year_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-40" data-line-number="40"></a>
<a class="sourceLine" id="cb8-41" data-line-number="41"><span class="kw">ggplot</span>(sst_ALL_both_clim_KS_p_long, <span class="kw">aes</span>(<span class="dt">x =</span> year_<span class="dv">1</span>, <span class="dt">y =</span> year_<span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-42" data-line-number="42"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> p.value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-43" data-line-number="43"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(sst_ALL_both_clim_KS_p_long, p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb8-44" data-line-number="44">             <span class="dt">size =</span> <span class="fl">0.01</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-45" data-line-number="45"><span class="st">  </span><span class="co"># geom_text(aes(label = round(adj.p.value, 2))) +</span></a>
<a class="sourceLine" id="cb8-46" data-line-number="46"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">midpoint =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-47" data-line-number="47"><span class="st">  </span><span class="kw">coord_equal</span>(<span class="dt">expand =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-48" data-line-number="48"><span class="st">  </span><span class="kw">facet_grid</span>(site<span class="op">~</span>metric<span class="op">+</span>trend) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-49" data-line-number="49"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">""</span>)</a></code></pre></div>
<p>The table above shows that while climatology values only generated from short time series against long time series tend to be significantly different when tested with an ANOVA, Kolmogorov-Smirnov tests on the shape of these distributions say otherwise. For the <code>WA</code> time series, nearly any comparison being made will show that the climatology distributions are significantly different. However, we also see different patterns in each of the other two time series. These results do not show one clear pattern and so one is left to wonder how representative these results are. This will require that this analysis be run on a global scale as well.</p>
</div>
</div>
<div id="mhw-metrics" class="section level3">
<h3 class="hasAnchor">
<a href="#mhw-metrics" class="anchor"></a>MHW metrics</h3>
<div id="anova" class="section level4">
<h4 class="hasAnchor">
<a href="#anova" class="anchor"></a>ANOVA</h4>
<p>With the effects of shortened time series on the calculation of climatologies quantified, we will now compare the results of the MHWs detected using an ANOVA. Unfortunately, in order to make a direct comparison of all of the MHW detected in the different time series lengths, we may only use the date range for the shortest time series used. This means that only events whose peak dates occurred in 2012 – 2014 will be used.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># Calculate events and filter only those from 2002 -- 2011</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">sst_ALL_both_event &lt;-<span class="st"> </span>sst_ALL_both_clim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, trend, year_index) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">res =</span> <span class="kw">map</span>(data, detect_event_event)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">  </span><span class="kw">unnest</span>(res) <span class="co">#%&gt;% </span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="co"># filter(date_start &gt;= "2002-01-01", date_end &lt;= "2011-12-31") %&gt;% </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">  <span class="co"># select(-c(index_start:index_end, date_start:date_end))</span></a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># ANOVA p</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">sst_ALL_both_event_aov_p &lt;-<span class="st"> </span>sst_ALL_both_event <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(date_peak) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(site, trend, year_index, duration, intensity_mean, intensity_max, intensity_cumulative) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>site, <span class="op">-</span>trend) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">res =</span> <span class="kw">map</span>(data, event_aov_p)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>() <span class="co">#%&gt;% </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9">  <span class="co"># spread(key = metric, value = p.value)</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co"># visualise</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="kw">ggplot</span>(sst_ALL_both_event_aov_p, <span class="kw">aes</span>(<span class="dt">x =</span> site, <span class="dt">y =</span> metric)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> p.value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(p.value, <span class="dv">2</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">midpoint =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">75</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>trend)</a></code></pre></div>
<p>The heatmap above shows us that the removal of the long-term trend in the time series often has a significant impact on how much the detected MHWs may differ depending on time series length. Curiously, detrending the time series actually makes the differences between the max and mean intensities not significant for the <code>NW_Atl</code> time series. The opposite is true for the other two time series. What’s also interesting is that when the trend is left in, none of the MHW metrics for events detected in the <code>Med</code> differ significantly, but the removal of the trend causes all of them to become significantly different.</p>
</div>
<div id="post-hoc-tukey-test-1" class="section level4">
<h4 class="hasAnchor">
<a href="#post-hoc-tukey-test-1" class="anchor"></a>Post-hoc Tukey test</h4>
<p>It should not be surprising that comparing events detected from a climatology based on three years of data may differ significantly from those based on 34 years of data. Where the differences emerge is the real question. And to find this out we will use a post-hoc TUkey test, as done for the climatologies above.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">sst_ALL_both_event_tukey &lt;-<span class="st"> </span>sst_ALL_both_event <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(date_peak) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(site, trend, year_index, duration, intensity_mean, intensity_max, intensity_cumulative) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">year_index =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">as.factor</a></span>(year_index)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">group_by</a></span>(site, trend) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">res =</span> <span class="kw">map</span>(data, event_aov_tukey)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span>(<span class="dt">col =</span> comparison, <span class="dt">into =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"comp1"</span>, <span class="st">"comp2"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">comp1 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(comp1), </a>
<a class="sourceLine" id="cb11-12" data-line-number="12">         <span class="dt">comp2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(comp2))</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="kw">ggplot</span>(sst_ALL_both_event_tukey, <span class="kw">aes</span>(<span class="dt">x =</span> comp2, <span class="dt">y =</span> comp1)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> adj.p.value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(sst_ALL_both_event_tukey, adj.p.value <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">             <span class="dt">size =</span> <span class="fl">0.01</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="st">  </span><span class="co"># geom_text(aes(label = round(adj.p.value, 2))) +</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">midpoint =</span> <span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="st">  </span><span class="kw">coord_equal</span>(<span class="dt">expand =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="st">  </span><span class="kw">facet_grid</span>(site<span class="op">~</span>metric<span class="op">+</span>trend) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">""</span>)</a></code></pre></div>
<p>The results of the Tukey tests shown above demonstrate that, except for one comparison, the differences between the events detected with different time series lengths do not differ significantly on a pairwise basis. There are however some interesting artifacts in the results that seem to show that some dramatic events may be having a large impact on how the results compare against one another.</p>
</div>
<div id="confidence-intervals" class="section level4">
<h4 class="hasAnchor">
<a href="#confidence-intervals" class="anchor"></a>Confidence intervals</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># ANOVA CI</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">sst_ALL_both_event_CI &lt;-<span class="st"> </span>sst_ALL_both_event <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span>(date_peak) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(site, trend, year_index, duration, intensity_mean, intensity_max, intensity_cumulative) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>site, <span class="op">-</span>trend) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/reexports">mutate</a></span>(<span class="dt">res =</span> <span class="kw">map</span>(data, event_aov_CI)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>()</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">CI_plot_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sst_ALL_both_event_CI, <span class="kw">aes</span>(<span class="dt">x =</span> year_index)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="dt">width =</span> <span class="dv">1</span>, <span class="dt">alpha =</span> <span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">                <span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper, <span class="dt">linetype =</span> trend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="st">  </span><span class="co"># geom_text(aes(label = n, y = upper*1.3, colour = trend), size = 3) +</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mid, <span class="dt">colour =</span> trend), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="st">  </span><span class="kw">facet_grid</span>(metric<span class="op">~</span>site, <span class="dt">scales =</span> <span class="st">"free_y"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"start year"</span>, <span class="dt">y =</span> <span class="st">"value"</span>)</a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co"># CI_plot_1</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18">CI_plot_<span class="fl">1.1</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(sst_ALL_both_event_CI, metric <span class="op">==</span><span class="st"> "duration"</span>), </a>
<a class="sourceLine" id="cb12-19" data-line-number="19">                      <span class="kw">aes</span>(<span class="dt">x =</span> year_index, <span class="dt">y =</span> n, <span class="dt">fill =</span> trend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>, <span class="dt">position =</span> <span class="st">"identity"</span>, <span class="dt">alpha =</span> <span class="fl">0.6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="st">  </span><span class="co"># geom_text(aes(label = n, y = upper*1.3, colour = trend), size = 3) +</span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="st">  </span><span class="co"># geom_point(aes(y = mid, colour = trend), size = 1, alpha = 0.7) +</span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>site) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"start year"</span>, <span class="dt">y =</span> <span class="st">"event count (n)"</span>)</a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="co"># CI_plot_1.1</span></a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggpubr/topics/ggarrange">ggarrange</a></span>(CI_plot_<span class="dv">1</span>, CI_plot_<span class="fl">1.1</span>, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">common.legend =</span> T, <span class="dt">heights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="fl">0.5</span>))</a></code></pre></div>
<p>Please note that the events being compared here, and so the CIs seen above, are only for those with peak dates in the years 2012 – 2014 so as not to violate the assumption that the sample sizes are similar. Therefore the overall number of events tends to be lower, which has led me to use basic bootstrapping to create the CIs above. This figure is rather busy, but we see on the bottom row that nearly twice as many MHWs were detected in the <code>NW_Atl</code> than the other two time series. This trend tends to hold true for all of the CIs. So when fewer events are detected, the CIs spread out. Looking at the top four rows we also see that when more years of data are used to calculate the climatologies with detrended data, fewer events are detected, but they tend to be stronger/longer. These differences generally do not appear to be significant.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#real-trend-vs-no-trend">Real trend vs. no trend</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robert W. Schlegel, Eric C. J. Oliver, Alistair J. Hobday, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
