<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Default MHW outputs in R and Python • MHWdetection</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Default MHW outputs in R and Python">
<meta property="og:description" content="This vignette compares the code/work flow one would use to calculate default (Hobday et al. 2016) MHWs in both R and Python as well as the different outputs and speeds.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MHWdetection</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/r_vs_python.html">Python vs. R - default outputs</a>
    </li>
    <li>
      <a href="../articles/r_vs_python_arguments.html">Python vs. R - default arguments</a>
    </li>
    <li>
      <a href="../articles/r_vs_python_additional.html">Python vs. R - additional functions</a>
    </li>
    <li>
      <a href="../articles/Short_climatologies.html">Short climatologies</a>
    </li>
    <li>
      <a href="../articles/Climatologies_and_baselines.html">Alternative climatologies and baselines</a>
    </li>
    <li>
      <a href="../articles/time_series_duration.html">Effects of short time series</a>
    </li>
    <li>
      <a href="../articles/missing_data.html">Effects of missing data</a>
    </li>
    <li>
      <a href="../articles/gridded_products.html">Difference between gridded products</a>
    </li>
    <li>
      <a href="../articles/best_practices.html">Best practices</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/robwschlegel/MHWdetection">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Default MHW outputs in R and Python</h1>
                        <h4 class="author">Robert W Schlegel</h4>
            
            <h4 class="date">2018-09-05</h4>
      
      
      <div class="hidden name"><code>r_vs_python.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The purpose of this vignette is to walk one through how to calculate MHWs in both the R and Python languages. It will use code from both languages throughout. The secondary purpose of this vignette is to show that the outputs are identical. The tertiary purpose of this vignette is to run benchmarks on the code to compare their speeds.</p>
</div>
<div id="calculating-events" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-events" class="anchor"></a>Calculating events</h2>
<p>First up, let’s look at the two different ways in which one may calculate MHWs. First up, the R code, then Python.</p>
<div id="r-code" class="section level3">
<h3 class="hasAnchor">
<a href="#r-code" class="anchor"></a>R code</h3>
<div id="setup" class="section level4">
<h4 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h4>
<p>The basic functionality for calculating marine heatwaves (MHWs) in R may be found in the <strong><code>heatwaveR</code></strong> package that may currently be downloaded and installed with the following lines of code. Note that if one has already installed these packages they do not need to be installed again. To run one of the lines in the following code chunk will require that the hashtag first be removed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("devtools")</span>
## Development version from GitHub
<span class="co"># devtools::install_github("robwschlegel/heatwaveR") </span>
## Stable version from rOpenSci
## Currently not available
## Stable version from CRAN
<span class="co"># install.packages("heatwaveR") # Currently not available</span></code></pre></div>
<p>With the necessary packages installed, we activate <code>heatwaveR</code> with the following line of code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(heatwaveR)</code></pre></div>
</div>
<div id="default-output" class="section level4">
<h4 class="hasAnchor">
<a href="#default-output" class="anchor"></a>Default output</h4>
<p>With everything downloaded and ready for us to use we may now calculate some events. The <code>heatwaveR</code> package has three built in time series (<code>sst_WA</code>, <code>sst_Med</code>, <code>sst_NW_Atl</code>) that we may use to more easily demonstrate how the code works. The general pipeline in <code>R</code> for calculating events is first to create a climatology from a chosen time series using <code><a href="http://www.rdocumentation.org/packages/heatwaveR/topics/ts2clm">ts2clm()</a></code>, and then to feed that ooutput into <code><a href="http://www.rdocumentation.org/packages/heatwaveR/topics/detect_event">detect_event()</a></code>, as seen below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First we create a default climatology as outlined in Hobday et al. (2016)</span>
ts_clim &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/heatwaveR/topics/ts2clm">ts2clm</a></span>(<span class="dt">data =</span> sst_WA, <span class="dt">climatologyPeriod =</span> <span class="kw">c</span>(<span class="st">"1982-01-01"</span>, <span class="st">"2014-12-31"</span>))

<span class="co"># Then we feed that object into the second and final function</span>
res &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/heatwaveR/topics/detect_event">detect_event</a></span>(ts_clim)</code></pre></div>
<p>To look at these outputs we would use the following options. For now we’ll just look at the event output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Look at the top six rows of the first 6 columns of the events</span>
res<span class="op">$</span>event[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   event_no index_start index_peak index_end duration date_start
##      &lt;int&gt;       &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt; &lt;date&gt;    
## 1        1         884        887       895       12 1984-06-02
## 2        2         899        901       904        6 1984-06-17
## 3        3         908        922       926       19 1984-06-26
## 4        4        1008       1010      1012        5 1984-10-04
## 5        5        1023       1027      1029        7 1984-10-19
## 6        6        1033       1034      1052       20 1984-10-29</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Or perhaps the most intense event</span>
res<span class="op">$</span>event[res<span class="op">$</span>event<span class="op">$</span>intensity_max <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(res<span class="op">$</span>event<span class="op">$</span>intensity_max), <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   event_no index_start index_peak index_end duration date_start
##      &lt;int&gt;       &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt; &lt;date&gt;    
## 1       42       10629      10651     10689       61 2011-02-06</code></pre>
</div>
</div>
<div id="python-code" class="section level3">
<h3 class="hasAnchor">
<a href="#python-code" class="anchor"></a>Python code</h3>
<div id="setup-1" class="section level4">
<h4 class="hasAnchor">
<a href="#setup-1" class="anchor"></a>Setup</h4>
<p>To download and install the Python package for calculating MHWs one may run the following line of code in a console:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Note that the hashtag must be removed in order</span>
<span class="co"># pip install git+git://github.com/ecjoliver/marineHeatWaves@master</span></code></pre></div>
<p>Or simply download the <a href="https://github.com/ecjoliver/marineHeatWaves">GitHub repository</a> and follow the instructions there for downloading. Or if still lost, phone a friend!</p>
<p>Before we begin the calculations we need to crerate a time series. I’ve chosen to take the <code>sst_WA</code> time series from the <strong><code>heatwaveR</code></strong> package to ensure consistency between the results. For ease of use I simply saved this object as a csv file on my computer and loaded it back in to Python.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ts &lt;-<span class="st"> </span>sst_WA
<span class="co"># Write out only a vector of temperatures</span>
<span class="kw">write.csv</span>(ts<span class="op">$</span>temp, <span class="st">"data/sst_WA.csv"</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="default-calculations" class="section level4">
<h4 class="hasAnchor">
<a href="#default-calculations" class="anchor"></a>Default calculations</h4>
<p>With the package installed it is then activated and run as follows:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co"># Required for data prep and export</span>
<span class="im">import</span> numpy <span class="im">as</span> np
<span class="im">from</span> datetime <span class="im">import</span> date
<span class="im">import</span> pandas <span class="im">as</span> pd
<span class="co"># The MHW functions</span>
<span class="im">import</span> marineHeatWaves <span class="im">as</span> mhw
<span class="co"># The date values</span>
t <span class="op">=</span> np.arange(date(<span class="dv">1982</span>,<span class="dv">1</span>,<span class="dv">1</span>).toordinal(),date(<span class="dv">2014</span>,<span class="dv">12</span>,<span class="dv">31</span>).toordinal()<span class="op">+</span><span class="dv">1</span>)
<span class="co"># The temperature values</span>
sst <span class="op">=</span> np.loadtxt(<span class="bu">open</span>(<span class="st">"data/sst_WA.csv"</span>, <span class="st">"r"</span>), delimiter<span class="op">=</span><span class="st">','</span>, skiprows<span class="op">=</span><span class="dv">1</span>) <span class="co"># because a heading row needs to be skipped</span>
<span class="co"># The event metrics</span>
mhws, clim <span class="op">=</span> mhw.detect(t, sst)
<span class="co"># Save event results</span>
mhws_df <span class="op">=</span> pd.DataFrame.from_dict(mhws)
mhws_df.to_csv(<span class="st">'data/mhws_py.csv'</span>, sep <span class="op">=</span> <span class="st">','</span>, index<span class="op">=</span><span class="va">False</span>)
<span class="co"># Save climatology results</span>
clim_df <span class="op">=</span> pd.DataFrame.from_dict(clim)
clim_df.to_csv(<span class="st">'data/clim_py.csv'</span>, sep <span class="op">=</span> <span class="st">','</span>, index<span class="op">=</span><span class="va">False</span>)</code></pre></div>
</div>
</div>
<div id="reticulate-code" class="section level3">
<h3 class="hasAnchor">
<a href="#reticulate-code" class="anchor"></a>Reticulate code</h3>
<p>It is also possible to run the Python code through R with the use of the R package <strong><code>reticulate</code></strong>. This is particularly useful as it allows us to perform the comparisons and benchmarking all within the same language.</p>
<div id="setup-2" class="section level4">
<h4 class="hasAnchor">
<a href="#setup-2" class="anchor"></a>Setup</h4>
<p>Here we load the <strong><code>reticulate</code></strong> package and choose the conda environment I’ve already created called <code>py27</code>. For help on how to set up a conda environment go <a href="https://conda.io/docs/user-guide/tasks/manage-environments.html">here</a>. I’ve ensured that all of the required python modules are installed within this environment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("reticulate")</span>
<span class="kw">library</span>(reticulate)
<span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/use_python">use_condaenv</a></span>(<span class="st">"py27"</span>)</code></pre></div>
<p>Once we’ve told R which version/environment we would like to use for Python we may then load the necessary modules.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">np &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/import">import</a></span>(<span class="st">"numpy"</span>)
datetime &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/import">import</a></span>(<span class="st">"datetime"</span>)
mhw &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/import">import</a></span>(<span class="st">"marineHeatWaves"</span>)</code></pre></div>
<p>One may run python code in it’s native form within R by passing it as a character vector to <code><a href="http://www.rdocumentation.org/packages/reticulate/topics/py_run">py_run_string()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/py_run">py_run_string</a></span>(<span class="st">"x = 10"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/py_run">py_run_string</a></span>(<span class="st">"t = np.arange(date(1982,1,1).toordinal(),date(2014,12,31).toordinal()+1)"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/reticulate/topics/py_run">py_run_string</a></span>(<span class="st">"sst = np.loadtxt(open('data/sst_WA.csv', 'r'), delimiter=',', skiprows=1)"</span>)</code></pre></div>
</div>
<div id="default-calculations-1" class="section level4">
<h4 class="hasAnchor">
<a href="#default-calculations-1" class="anchor"></a>Default calculations</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># These numbers were taken from print(t) in the python code above</span>
t &lt;-<span class="st"> </span><span class="kw">as.integer</span>(np<span class="op">$</span><span class="kw">array</span>(<span class="kw">seq</span>(<span class="dv">723546</span>, <span class="dv">735598</span>)))
sst &lt;-<span class="st"> </span>np<span class="op">$</span><span class="kw">array</span>(sst_WA<span class="op">$</span>temp)
res_python &lt;-<span class="st"> </span>mhw<span class="op">$</span><span class="kw">detect</span>(<span class="dt">t =</span> py<span class="op">$</span>t, <span class="dt">temp =</span> py<span class="op">$</span>sst) <span class="co"># There appears to be an Rcpp issue preventing this from handshaking...</span></code></pre></div>
<pre><code>## Error in py_call_impl(callable, dots$args, dots$keywords): TypeError: integer argument expected, got float
## 
## Detailed traceback: 
##   File "/home/rws/anaconda2/envs/py27/lib/python2.7/site-packages/marineHeatWaves.py", line 188, in detect
##     year[i] = date.fromordinal(t[i]).year</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The reticulate package is still in development...</span></code></pre></div>
</div>
</div>
</div>
<div id="comparisons" class="section level2">
<h2 class="hasAnchor">
<a href="#comparisons" class="anchor"></a>Comparisons</h2>
<p>With some climatologies and events calculated with both languages we may now compare the results of the two. I’ll do so here natively in R to avoid any potential hiccups from translating across languages. I’ll create the R output here, and load the Python output created above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load libraries for data manipulation and visualisation</span>
<span class="kw">library</span>(tidyverse)

<span class="co"># Set R results</span>
res_event_R &lt;-<span class="st"> </span>res<span class="op">$</span>event
res_clim_R &lt;-<span class="st"> </span>res<span class="op">$</span>climatology

<span class="co"># Set Python results</span>
res_event_Python &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"data/mhws_py.csv"</span>)
res_clim_Python &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"data/clim_py.csv"</span>)</code></pre></div>
<p>With these default results loaded in the same format in the same language we can now start to look at how they stack up. For starters I am just doing some simple sums and correlations.</p>
<div id="climatologies" class="section level3">
<h3 class="hasAnchor">
<a href="#climatologies" class="anchor"></a>Climatologies</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(res_clim_R<span class="op">$</span>seas, res_clim_Python<span class="op">$</span>seas)</code></pre></div>
<pre><code>## [1] 0.9999999</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(res_clim_R<span class="op">$</span>seas) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(res_clim_Python<span class="op">$</span>seas)</code></pre></div>
<pre><code>## [1] -2.039741</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(res_clim_R<span class="op">$</span>thresh, res_clim_Python<span class="op">$</span>thresh)</code></pre></div>
<pre><code>## [1] 0.9999996</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(res_clim_R<span class="op">$</span>thresh) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(res_clim_Python<span class="op">$</span>thresh)</code></pre></div>
<pre><code>## [1] -6.563502</code></pre>
<p>The seasonal and threshold climatologies correlate very well, but adding them up we see that the Python values are consistently higher. This is due to rounding differences between the languages. Now for the events.</p>
</div>
<div id="events" class="section level3">
<h3 class="hasAnchor">
<a href="#events" class="anchor"></a>Events</h3>
<p>First we peak at a few specific values of interest.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(res_event_R<span class="op">$</span>intensity_max, res_event_Python<span class="op">$</span>intensity_max)</code></pre></div>
<pre><code>## [1] 0.9999997</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(res_event_R<span class="op">$</span>intensity_max) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(res_event_Python<span class="op">$</span>intensity_max)</code></pre></div>
<pre><code>## [1] 0.008638202</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(res_event_R<span class="op">$</span>intensity_var, res_event_Python<span class="op">$</span>intensity_var)</code></pre></div>
<pre><code>## [1] 0.999608</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(res_event_R<span class="op">$</span>intensity_var) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(res_event_Python<span class="op">$</span>intensity_var)</code></pre></div>
<pre><code>## [1] 0.7344747</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(res_event_R<span class="op">$</span>rate_onset, res_event_Python<span class="op">$</span>rate_onset)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(res_event_R<span class="op">$</span>rate_onset) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(res_event_Python<span class="op">$</span>rate_onset)</code></pre></div>
<pre><code>## [1] -0.0001461964</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(res_event_R<span class="op">$</span>rate_decline, res_event_Python<span class="op">$</span>rate_decline)</code></pre></div>
<pre><code>## [1] 0.9999999</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(res_event_R<span class="op">$</span>rate_decline) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(res_event_Python<span class="op">$</span>rate_decline)</code></pre></div>
<pre><code>## [1] 0.0002725762</code></pre>
<p>With that looking fine, we next run a for loop that will run a correlation on all rows with the same name.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Remove non-numeric columns</span>
res_event_num &lt;-<span class="st"> </span>res_event_R <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select_if</span>(is.numeric)

<span class="co"># Run the loop</span>
res_event &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">colnames</span>(res_event_num))){
  <span class="cf">if</span>(<span class="kw">colnames</span>(res_event_num)[i] <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(res_event_Python)){
    x1 &lt;-<span class="st"> </span>res_event_R[<span class="kw">colnames</span>(res_event_R) <span class="op">==</span><span class="st"> </span><span class="kw">colnames</span>(res_event_num)[i]]
    x2 &lt;-<span class="st"> </span>res_event_Python[<span class="kw">colnames</span>(res_event_Python) <span class="op">==</span><span class="st"> </span><span class="kw">colnames</span>(res_event_num)[i]]
    x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">r =</span> <span class="kw">cor</span>(x1, x2, <span class="dt">use =</span> <span class="st">"complete.obs"</span>),
                    <span class="dt">difference =</span> <span class="kw">round</span>(<span class="kw">sum</span>(x1, <span class="dt">na.rm =</span> T) <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(x2, <span class="dt">na.rm =</span> T), <span class="dv">4</span>),
                    <span class="dt">var =</span> <span class="kw">colnames</span>(res_event_num)[i])
    <span class="kw">colnames</span>(x)[<span class="dv">1</span>] &lt;-<span class="st"> "r"</span>
    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span><span class="ot">NULL</span>
    } <span class="cf">else</span> {
      x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">r =</span> <span class="ot">NA</span>, <span class="dt">difference =</span> <span class="ot">NA</span>, <span class="dt">var =</span> <span class="kw">colnames</span>(res_event_num)[i])
      }
  res_event &lt;-<span class="st"> </span><span class="kw">rbind</span>(res_event, x)
  }
res_event</code></pre></div>
<pre><code>##            r difference                            var
## 1         NA         NA                       event_no
## 2  1.0000000    60.0000                    index_start
## 3  1.0000000    60.0000                     index_peak
## 4  1.0000000    60.0000                      index_end
## 5  1.0000000     0.0000                       duration
## 6  0.9999991     0.0086                 intensity_mean
## 7  0.9999997     0.0086                  intensity_max
## 8  0.9996080     0.7345                  intensity_var
## 9  1.0000000     0.1616           intensity_cumulative
## 10 0.9999971     0.0158       intensity_mean_relThresh
## 11 0.9999994     0.0166        intensity_max_relThresh
## 12 0.9995685     0.7374        intensity_var_relThresh
## 13 0.9999996     0.4741 intensity_cumulative_relThresh
## 14 1.0000000     0.0000             intensity_mean_abs
## 15 0.9990733     1.6100              intensity_max_abs
## 16 0.9997267     0.7667              intensity_var_abs
## 17 1.0000000     0.0000       intensity_cumulative_abs
## 18 1.0000000    -0.0001                     rate_onset
## 19 0.9999999     0.0003                   rate_decline</code></pre>
<p>With all of our overlapping columns compared, and our differences and Pearson r values looking solid, let’s finish off this basic comparison by finding which columns are not shared between the different language outputs. Also, please note that the apparently large differences between the <code>index_start</code>, <code>index_peak</code>, and <code>index_end</code> values are due to the different indexing methods of R and Python. R starts at 1 and Python at 0.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cols_R &lt;-<span class="st"> </span><span class="kw">colnames</span>(res_event_R)[<span class="op">!</span>(<span class="kw">colnames</span>(res_event_R) <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(res_event_Python))]
cols_R</code></pre></div>
<pre><code>## [1] "event_no"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cols_Py &lt;-<span class="st"> </span><span class="kw">colnames</span>(res_event_Python)[<span class="op">!</span>(<span class="kw">colnames</span>(res_event_Python) <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(res_event_R))]
cols_Py</code></pre></div>
<pre><code>## [1] "category"          "duration_extreme"  "duration_moderate"
## [4] "duration_severe"   "duration_strong"   "n_events"         
## [7] "time_end"          "time_peak"         "time_start"</code></pre>
<p>Wonderful! Most things match up nicely. The duration of categories of events is something added in R by another function <code><a href="http://www.rdocumentation.org/packages/heatwaveR/topics/category">category()</a></code>, and will be left that way for now. The “time” columns in the Python output aren’t relavent as far as I can see in the present usage as these functions currently only take day values. THe different methods of labelling the events will be left as they are for now as well.</p>
<p>It is also worth noting that the values for <code>index_start</code>, <code>index_peak</code>, and <code>index_end</code> are off by one between the two languages. This is due to the difference in indexing between the languages. Looking at the <code>date_start</code>, <code>date_peak</code>, and <code>date_end</code> values we see that they are the same.</p>
</div>
</div>
<div id="benchmarks" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmarks" class="anchor"></a>Benchmarks</h2>
<p>The final thing we want to look at in this vignette is the speed differences in calculating MHWs between the two languages.</p>
<div id="r" class="section level3">
<h3 class="hasAnchor">
<a href="#r" class="anchor"></a>R</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(microbenchmark)
<span class="co"># The old R code</span>
<span class="kw">library</span>(RmarineHeatWaves)
<span class="kw"><a href="http://www.rdocumentation.org/packages/microbenchmark/topics/microbenchmark">microbenchmark</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/RmarineHeatWaves/topics/detect">detect</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/RmarineHeatWaves/topics/make_whole">make_whole</a></span>(<span class="dt">data =</span> sst_WA), <span class="dt">climatology_start =</span> <span class="st">"1982-01-01"</span>, <span class="dt">climatology_end =</span> <span class="st">"2014-12-31"</span>), <span class="dt">times =</span> <span class="dv">10</span>)</code></pre></div>
<pre><code>## Unit: milliseconds
##                                                                                                      expr
##  detect(make_whole(data = sst_WA), climatology_start = "1982-01-01",      climatology_end = "2014-12-31")
##       min       lq     mean   median       uq      max neval
##  677.5837 681.5922 873.8009 699.8798 883.0094 1947.545    10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The new R code</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/microbenchmark/topics/microbenchmark">microbenchmark</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/heatwaveR/topics/detect_event">detect_event</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/heatwaveR/topics/ts2clm">ts2clm</a></span>(<span class="dt">data =</span> sst_WA, <span class="dt">climatologyPeriod =</span> <span class="kw">c</span>(<span class="st">"1982-01-01"</span>, <span class="st">"2014-12-31"</span>), <span class="dt">robust =</span> <span class="ot">FALSE</span>)), <span class="dt">times =</span> <span class="dv">10</span>)</code></pre></div>
<pre><code>## Unit: milliseconds
##                                                                                                         expr
##  detect_event(ts2clm(data = sst_WA, climatologyPeriod = c("1982-01-01",      "2014-12-31"), robust = FALSE))
##       min       lq     mean  median      uq      max neval
##  167.6448 174.1651 241.5099 182.385 334.037 355.6131    10</code></pre>
</div>
<div id="python" class="section level3">
<h3 class="hasAnchor">
<a href="#python" class="anchor"></a>Python</h3>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> time
total <span class="op">=</span> <span class="dv">0</span>
<span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):
    start <span class="op">=</span> time.clock()
    mhws, clim <span class="op">=</span> mhw.detect(t, sst)
    end <span class="op">=</span> time.clock()
    total <span class="op">+=</span> end<span class="op">-</span>start
bench_py <span class="op">=</span> total<span class="op">/</span><span class="dv">10</span>
<span class="bu">print</span>(bench_py)</code></pre></div>
<pre><code>## 0.1806082</code></pre>
<p>The Python code appears to be about twoce as fast at ~0.18 seconds to ~0.32 seconds for R. And the Python code is also calculating the event categories, which R is not. That is done in an additonal step with <code><a href="http://www.rdocumentation.org/packages/heatwaveR/topics/category">category()</a></code>. The R code is however allowing for a wider range of options for climaotlogies.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#calculating-events">Calculating events</a></li>
      <li><a href="#comparisons">Comparisons</a></li>
      <li><a href="#benchmarks">Benchmarks</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robert W. Schlegel, Eric C. J. Oliver, Alistair J. Hobday, Albertus J. Smit.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
